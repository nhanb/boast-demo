<!DOCTYPE html>
<html lang="en" style="font-family: monospace;"><head><title>[2715846b1f] better chapter number, create migration | pytaku | Boast</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><strong><a href="../../">Repos</a> / <a href="../">pytaku</a> / 2715846b1f</strong><hr><pre>commit 2715846b1f248c022e40876d47bfabbe3f5ecb6b
Author: Bùi Thành Nhân &lt;hi@imnhan.com&gt;
Date:   Tue May 5 12:39:46 2020 +0700

    better chapter number, create migration

diff --git a/README.md b/README.md
index 6c76f86..fbc6196 100644
--- a/README.md
+++ b/README.md
@@ -31,7 +31,7 @@ # (see [tool.poetry.scripts] in pyproject.toml)
 pyenv deactivate &amp;&amp; pyenv activate
 
 # generate initial config for local dev - should work out of the box with the
-# db provided docker-compose above.
+# db provided by docker-compose above.
 make localconfig
 
 make dev
diff --git a/src/pytaku/settings.py b/src/pytaku/settings.py
index dac1ae6..d0ab210 100644
--- a/src/pytaku/settings.py
+++ b/src/pytaku/settings.py
@@ -41,6 +41,7 @@
     &quot;django.contrib.sessions&quot;,
     &quot;django.contrib.messages&quot;,
     &quot;django.contrib.staticfiles&quot;,
+    &quot;pytaku_web&quot;,
 ]
 
 MIDDLEWARE = [
diff --git a/src/pytaku/test_settings.py b/src/pytaku/test_settings.py
new file mode 100644
index 0000000..9f5b010
--- /dev/null
+++ b/src/pytaku/test_settings.py
@@ -0,0 +1,4 @@
+from .settings import *  # noqa
+
+DEFAULT_FILE_STORAGE = &quot;django.core.files.storage.FileSystemStorage&quot;
+MEDIA_ROOT = &quot;test_media&quot;
diff --git a/src/pytaku_web/migrations/0001_initial.py b/src/pytaku_web/migrations/0001_initial.py
new file mode 100644
index 0000000..0bdf305
--- /dev/null
+++ b/src/pytaku_web/migrations/0001_initial.py
@@ -0,0 +1,54 @@
+# Generated by Django 3.0.5 on 2020-05-05 05:41
+
+import django.contrib.postgres.fields
+from django.db import migrations, models
+import django.db.models.deletion
+
+
+class Migration(migrations.Migration):
+
+    initial = True
+
+    dependencies = [
+    ]
+
+    operations = [
+        migrations.CreateModel(
+            name=&#39;Title&#39;,
+            fields=[
+                (&#39;id&#39;, models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name=&#39;ID&#39;)),
+                (&#39;site&#39;, models.CharField(max_length=50)),
+                (&#39;original_id&#39;, models.CharField(max_length=255)),
+                (&#39;name&#39;, models.CharField(max_length=255)),
+                (&#39;alt_names&#39;, django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), default=list, size=None)),
+                (&#39;cover&#39;, models.CharField(max_length=255)),
+                (&#39;descriptions&#39;, django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), default=list, size=None)),
+                (&#39;publication_status&#39;, models.CharField(max_length=100)),
+                (&#39;authors&#39;, django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), default=list, size=None)),
+                (&#39;tags&#39;, django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=50), default=list, size=None)),
+            ],
+            options={
+                &#39;db_table&#39;: &#39;title&#39;,
+            },
+        ),
+        migrations.CreateModel(
+            name=&#39;Chapter&#39;,
+            fields=[
+                (&#39;id&#39;, models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name=&#39;ID&#39;)),
+                (&#39;original_id&#39;, models.CharField(max_length=255)),
+                (&#39;name&#39;, models.CharField(max_length=255)),
+                (&#39;num_major&#39;, models.PositiveIntegerField()),
+                (&#39;num_minor&#39;, models.PositiveIntegerField(blank=True, null=True)),
+                (&#39;pages&#39;, django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), default=list, size=None)),
+                (&#39;title&#39;, models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name=&#39;chapters&#39;, to=&#39;pytaku_web.Title&#39;)),
+            ],
+            options={
+                &#39;db_table&#39;: &#39;chapter&#39;,
+                &#39;ordering&#39;: [&#39;num_major&#39;, &#39;num_minor&#39;],
+            },
+        ),
+        migrations.AddConstraint(
+            model_name=&#39;chapter&#39;,
+            constraint=models.UniqueConstraint(fields=(&#39;title&#39;, &#39;num_major&#39;, &#39;num_minor&#39;), name=&#39;unique_number_within_title&#39;),
+        ),
+    ]
diff --git a/src/pytaku_web/models.py b/src/pytaku_web/models.py
index d465aae..3e94a2a 100644
--- a/src/pytaku_web/models.py
+++ b/src/pytaku_web/models.py
@@ -25,9 +25,11 @@ class Meta:
         db_table = &quot;chapter&quot;
         constraints = [
             models.UniqueConstraint(
-                fields=[&quot;title&quot;, &quot;ordering&quot;], name=&quot;unique_order_within_title&quot;
+                fields=[&quot;title&quot;, &quot;num_major&quot;, &quot;num_minor&quot;],
+                name=&quot;unique_number_within_title&quot;,
             )
         ]
+        ordering = [&quot;num_major&quot;, &quot;num_minor&quot;]
 
     original_id = models.CharField(max_length=255)
     name = models.CharField(max_length=255)
</pre></body></html>