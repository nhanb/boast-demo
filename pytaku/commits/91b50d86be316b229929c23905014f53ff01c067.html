<!DOCTYPE html>
<html lang="en" style="font-family: monospace;"><head><title>[91b50d86be] login &amp; search | pytaku | Boast</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><strong><a href="../../">Repos</a> / <a href="../">pytaku</a> / 91b50d86be</strong><hr><pre>commit 91b50d86be316b229929c23905014f53ff01c067
Author: Bùi Thành Nhân &lt;hi@imnhan.com&gt;
Date:   Sat Aug 1 20:48:19 2020 +0700

    login &amp; search

diff --git a/.gitignore b/.gitignore
index 32201b5..68e2f20 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,4 @@
+/debug.py
 __pycache__
 *.pyc
 *.json
diff --git a/src/mangoapi/__init__.py b/src/mangoapi/__init__.py
index 36b053a..ce64c4c 100644
--- a/src/mangoapi/__init__.py
+++ b/src/mangoapi/__init__.py
@@ -1,5 +1,13 @@
+import re
+
 import requests
 
+# Titles regex slightly adapted from https://github.com/md-y/mangadex-full-api
+# Thanks!
+TITLES_PATTERN = re.compile(
+    r&quot;&quot;&quot;&lt;a[^&gt;]*href=[&quot;&#39;]\/title\/(\d+)\/\S+[&quot;&#39;][^&gt;]*manga_title[^&gt;]*&gt;([^&lt;]*)&lt;&quot;&quot;&quot;
+)
+
 
 def _parse_chapter_number(string):
     nums = string.split(&quot;.&quot;)
@@ -62,3 +70,33 @@ def get_chapter(chapter_id):
         **_parse_chapter_number(md_json[&quot;chapter&quot;]),
     }
     return chapter
+
+
+def login(username, password):
+    &quot;&quot;&quot;
+    Returns cookies of a logged in user.
+    &quot;&quot;&quot;
+    form_data = {
+        &quot;login_username&quot;: username,
+        &quot;login_password&quot;: password,
+        &quot;two_factor&quot;: &quot;&quot;,
+        &quot;remember_me&quot;: &quot;1&quot;,
+    }
+    md_resp = requests.post(
+        &quot;https://mangadex.org/ajax/actions.ajax.php?function=login&quot;,
+        data=form_data,
+        headers={&quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;},
+    )
+    assert md_resp.status_code == 200, md_resp.text
+    return dict(md_resp.cookies)
+
+
+def search_title(user_cookies, query):
+    md_resp = requests.get(
+        f&quot;https://mangadex.org/quick_search/{query}&quot;, cookies=user_cookies,
+    )
+    assert md_resp.status_code == 200, md_resp.text
+
+    matches = TITLES_PATTERN.findall(md_resp.text)
+    titles = [{&quot;id&quot;: int(id), &quot;name&quot;: name.strip()} for id, name in matches]
+    return titles
</pre></body></html>