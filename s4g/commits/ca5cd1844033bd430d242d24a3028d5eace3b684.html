<!DOCTYPE html>
<html lang="en" style="font-family: monospace;"><head><title>[ca5cd18440] use front matter instead | s4g | Boast</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><strong><a href="../../">Repos</a> / <a href="../">s4g</a> / ca5cd18440</strong><hr><pre>commit ca5cd1844033bd430d242d24a3028d5eace3b684
Author: Nh√¢n &lt;hi@imnhan.com&gt;
Date:   Thu Jun 29 11:33:06 2023 +0700

    use front matter instead

diff --git a/main.go b/main.go
index 8abca0e..ebc5a52 100644
--- a/main.go
+++ b/main.go
@@ -7,6 +7,7 @@
 	&quot;net/http&quot;
 	&quot;os&quot;
 	&quot;path/filepath&quot;
+	&quot;strings&quot;
 
 	&quot;github.com/BurntSushi/toml&quot;
 )
@@ -26,7 +27,11 @@ func main() {
 	meta := readSiteMetadata(fsys)
 	fmt.Println(&quot;Found site:&quot;, meta)
 
-	findPosts(fsys)
+	articles := findArticles(fsys)
+	fmt.Printf(&quot;Found %d articles:\n&quot;, len(articles))
+	for _, a := range articles {
+		fmt.Println(&quot;&gt;&quot;, a.Path, &quot;-&quot;, a.Meta.Title)
+	}
 
 	println(&quot;Serving local website at http://localhost:&quot; + port)
 	http.Handle(&quot;/&quot;, http.FileServer(http.FS(fsys)))
@@ -51,19 +56,50 @@ func readSiteMetadata(fsys fs.FS) (sm SiteMetadata) {
 
 type Article struct {
 	Path     string
-	Title    string
 	DjotBody string
+	Meta     ArticleMetadata
+}
+
+type ArticleMetadata struct {
+	Title  string
+	IsPage bool
 }
-type Post Article
-type Page Article
 
-func findPosts(fsys fs.FS) (posts []Post) {
-	var paths []string
+func findArticles(fsys fs.FS) (articles []Article) {
+
 	fs.WalkDir(fsys, &quot;.&quot;, func(path string, d fs.DirEntry, err error) error {
-		if d.Name() == &quot;post.toml&quot; {
-			paths = append(paths, filepath.Dir(path))
+		if d.IsDir() || !strings.HasSuffix(d.Name(), &quot;.dj&quot;) {
+			return nil
+		}
+
+		fileContent, err := fs.ReadFile(fsys, path)
+		if err != nil {
+			panic(err)
+		}
+
+		parts := strings.SplitN(string(fileContent), &quot;+++&quot;, 3)
+		if !(len(parts) == 3 &amp;&amp; parts[0] == &quot;&quot;) {
+			fmt.Printf(&quot;FIXME: Missing metadata in %s - Skipped.\n&quot;, path)
+			return nil
+		}
+		metaText := strings.TrimSpace(parts[1])
+		bodyText := strings.TrimSpace(parts[2])
+
+		var meta ArticleMetadata
+		_, err = toml.Decode(metaText, &amp;meta)
+		if err != nil {
+			fmt.Printf(&quot;FIXME: Malformed article metadata in %s: %s&quot;, path, err)
+			return nil
+		}
+
+		article := Article{
+			Path:     path,
+			DjotBody: bodyText,
+			Meta:     meta,
 		}
+		articles = append(articles, article)
+		fmt.Printf(&quot;Found article %s - %s\n&quot;, article.Path, article.Meta.Title)
 		return nil
 	})
-	return posts
+	return articles
 }
diff --git a/www/about/index.dj b/www/about/index.dj
index 35ff8b8..e3f9cfe 100644
--- a/www/about/index.dj
+++ b/www/about/index.dj
@@ -1,3 +1,7 @@
++++
+Title = &quot;About&quot;
++++
+
 ## About this site
 
 It&#39;s a website.
diff --git a/www/about/page.toml b/www/about/page.toml
deleted file mode 100644
index 8b00bc3..0000000
--- a/www/about/page.toml
+++ /dev/null
@@ -1 +0,0 @@
-title = &quot;About&quot;
diff --git a/www/hello/index.dj b/www/hello/index.dj
index 18249f3..ff29966 100644
--- a/www/hello/index.dj
+++ b/www/hello/index.dj
@@ -1 +1,6 @@
++++
+Title = &quot;Hello&quot;
+IsPage = false
++++
+
 Hello world.
diff --git a/www/hello/post.toml b/www/hello/post.toml
deleted file mode 100644
index 5917a39..0000000
--- a/www/hello/post.toml
+++ /dev/null
@@ -1 +0,0 @@
-title = &quot;Good morning&quot;
</pre></body></html>