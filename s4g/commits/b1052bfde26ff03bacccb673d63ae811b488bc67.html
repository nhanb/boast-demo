<!DOCTYPE html>
<html lang="en" style="font-family: monospace;"><head><title>[b1052bfde2] very messy djot conversion PoC | s4g | Boast</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><strong><a href="../../">Repos</a> / <a href="../">s4g</a> / b1052bfde2</strong><hr><pre>commit b1052bfde26ff03bacccb673d63ae811b488bc67
Author: Nhân &lt;hi@imnhan.com&gt;
Date:   Sun Jul 2 20:38:07 2023 +0700

    very messy djot conversion PoC

diff --git a/.gitattributes b/.gitattributes
new file mode 100644
index 0000000..81c277b
--- /dev/null
+++ b/.gitattributes
@@ -0,0 +1 @@
+djot/js/djot.js linguist-vendored
diff --git a/Makefile b/Makefile
index aa6e5fe..784b3e7 100644
--- a/Makefile
+++ b/Makefile
@@ -1,2 +1,12 @@
+build:
+	go build -o dist/
+
 watch:
-	find . -name &#39;*.go&#39; | entr -rc go run .
+	find . -name &#39;*.go&#39; -or -name &#39;*.js&#39; | entr -rc go run .
+
+# Cheating a little because the djot.js repo on github does not provide builds
+update-djot:
+	curl -L &#39;https://djot.net/playground/djot.js&#39; &gt; djot/js/djot.js
+
+clean:
+	rm -rf dist/*
diff --git a/djot/djot.go b/djot/djot.go
new file mode 100644
index 0000000..174e50e
--- /dev/null
+++ b/djot/djot.go
@@ -0,0 +1,92 @@
+package djot
+
+import (
+	&quot;bufio&quot;
+	&quot;bytes&quot;
+	_ &quot;embed&quot;
+	&quot;fmt&quot;
+	&quot;os/exec&quot;
+)
+
+//go:embed js/djot.js
+var djotJs string
+
+//go:embed js/main.js
+var mainJs string
+
+var djotFullScript = djotJs + &quot;\n&quot; + mainJs
+
+const delimiter = 0xff
+
+type djotJSProc struct {
+	cmd     *exec.Cmd
+	writer  *bufio.Writer
+	scanner *bufio.Scanner
+}
+
+var service djotJSProc
+
+func init() {
+	service = StartService()
+	fmt.Println(&quot;Started djot.js service&quot;)
+}
+
+func StartService() djotJSProc {
+	cmd := exec.Command(&quot;node&quot;, &quot;-e&quot;, djotFullScript)
+
+	stdin, err := cmd.StdinPipe()
+	if err != nil {
+		panic(err)
+	}
+	stdout, err := cmd.StdoutPipe()
+	if err != nil {
+		panic(err)
+	}
+
+	writer := bufio.NewWriter(stdin)
+	scanner := bufio.NewScanner(stdout)
+	scanner.Split(splitAtDelimiter)
+
+	stderr, err := cmd.StderrPipe()
+	if err != nil {
+		panic(err)
+	}
+	go func() {
+		errscanner := bufio.NewScanner(stderr)
+		for errscanner.Scan() {
+			errtext := errscanner.Text()
+			fmt.Printf(&quot;XXX %s\n&quot;, errtext)
+		}
+	}()
+
+	err = cmd.Start()
+	if err != nil {
+		panic(err)
+	}
+
+	return djotJSProc{cmd: cmd, writer: writer, scanner: scanner}
+}
+
+func splitAtDelimiter(data []byte, atEOF bool) (advance int, token []byte, err error) {
+	idx := bytes.IndexByte(data, delimiter)
+	if idx == -1 {
+		return 0, nil, nil
+	}
+	return idx + 1, data[:idx], nil
+}
+
+// Not thread-safe.
+func ToHtml(input string) (result string) {
+	if _, err := service.writer.WriteString(input); err != nil {
+		panic(err)
+	}
+	if err := service.writer.WriteByte(delimiter); err != nil {
+		panic(err)
+	}
+	service.writer.Flush()
+
+	if !service.scanner.Scan() {
+		panic(&quot;scanner unexpectedly stopped while converting djot to html: &quot; + input[:50])
+	}
+	return service.scanner.Text()
+}
diff --git a/djot/js/djot.js b/djot/js/djot.js
new file mode 100644
index 0000000..0e2d961
--- /dev/null
+++ b/djot/js/djot.js
@@ -0,0 +1 @@
+!function(t,e){&quot;object&quot;==typeof exports&amp;&amp;&quot;object&quot;==typeof module?module.exports=e():&quot;function&quot;==typeof define&amp;&amp;define.amd?define([],e):&quot;object&quot;==typeof exports?exports.djot=e():t.djot=e()}(this,(()=&gt;(()=&gt;{&quot;use strict&quot;;var t={60:(t,e)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.isCaption=e.isRow=e.isBlock=e.isInline=void 0;const s={para:!0,heading:!0,block_quote:!0,thematic_break:!0,section:!0,div:!0,code_block:!0,raw_block:!0,bullet_list:!0,ordered_list:!0,task_list:!0,definition_list:!0,table:!0,reference:!0,footnote:!0};e.isBlock=function(t){return s[t.tag]||!1};const n={str:!0,soft_break:!0,hard_break:!0,non_breaking_space:!0,symb:!0,verbatim:!0,raw_inline:!0,inline_math:!0,display_math:!0,url:!0,email:!0,footnote_reference:!0,smart_punctuation:!0,emph:!0,strong:!0,link:!0,image:!0,span:!0,mark:!0,superscript:!0,subscript:!0,insert:!0,delete:!0,double_quoted:!0,single_quoted:!0};e.isInline=function(t){return n[t.tag]||!1},e.isRow=function(t){return&quot;head&quot;in t},e.isCaption=function(t){return!(&quot;head&quot;in t)}},722:(t,e)=&gt;{var s;Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.AttributeParser=void 0,function(t){t[t.SCANNING=0]=&quot;SCANNING&quot;,t[t.SCANNING_ID=1]=&quot;SCANNING_ID&quot;,t[t.SCANNING_CLASS=2]=&quot;SCANNING_CLASS&quot;,t[t.SCANNING_KEY=3]=&quot;SCANNING_KEY&quot;,t[t.SCANNING_VALUE=4]=&quot;SCANNING_VALUE&quot;,t[t.SCANNING_BARE_VALUE=5]=&quot;SCANNING_BARE_VALUE&quot;,t[t.SCANNING_QUOTED_VALUE=6]=&quot;SCANNING_QUOTED_VALUE&quot;,t[t.SCANNING_QUOTED_VALUE_CONTINUATION=7]=&quot;SCANNING_QUOTED_VALUE_CONTINUATION&quot;,t[t.SCANNING_ESCAPED=8]=&quot;SCANNING_ESCAPED&quot;,t[t.SCANNING_ESCAPED_IN_CONTINUATION=9]=&quot;SCANNING_ESCAPED_IN_CONTINUATION&quot;,t[t.SCANNING_COMMENT=10]=&quot;SCANNING_COMMENT&quot;,t[t.FAIL=11]=&quot;FAIL&quot;,t[t.DONE=12]=&quot;DONE&quot;,t[t.START=13]=&quot;START&quot;}(s||(s={}));const n=/^[a-zA-Z0-9_:-]/,i=[];i[s.START]=function(t,e){return&quot;{&quot;===t.subject.charAt(e)?s.SCANNING:s.FAIL},i[s.FAIL]=function(t,e){return s.FAIL},i[s.DONE]=function(t,e){return s.DONE},i[s.SCANNING]=function(t,e){const i=t.subject.charAt(e);return&quot; &quot;===i||&quot;\t&quot;===i||&quot;\n&quot;===i||&quot;\r&quot;===i?s.SCANNING:&quot;}&quot;===i?s.DONE:&quot;#&quot;===i?(t.begin=e,s.SCANNING_ID):&quot;%&quot;===i?(t.begin=e,s.SCANNING_COMMENT):&quot;.&quot;===i?(t.begin=e,s.SCANNING_CLASS):function(t){return null!==n.exec(t)}(i)?(t.begin=e,s.SCANNING_KEY):s.FAIL},i[s.SCANNING_COMMENT]=function(t,e){return&quot;%&quot;===t.subject.charAt(e)?s.SCANNING:s.SCANNING_COMMENT},i[s.SCANNING_ID]=function(t,e){const n=t.subject.substr(e,1);return null!==/^\w/.exec(n)||&quot;_&quot;===n||&quot;-&quot;===n||&quot;:&quot;===n?s.SCANNING_ID:&quot;}&quot;===n?(t.begin&amp;&amp;t.lastpos&amp;&amp;t.lastpos&gt;t.begin&amp;&amp;t.addEvent(t.begin+1,t.lastpos,&quot;id&quot;),t.begin=null,s.DONE):null!==/^\s/.exec(n)?(t.begin&amp;&amp;t.lastpos&amp;&amp;t.lastpos&gt;t.begin&amp;&amp;t.addEvent(t.begin+1,t.lastpos,&quot;id&quot;),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_CLASS]=function(t,e){const n=t.subject.substr(e,1);return null!==/^\w/.exec(n)||&quot;_&quot;===n||&quot;-&quot;===n||&quot;:&quot;===n?s.SCANNING_CLASS:&quot;}&quot;===n?(t.begin&amp;&amp;t.lastpos&amp;&amp;t.lastpos&gt;t.begin&amp;&amp;t.addEvent(t.begin+1,t.lastpos,&quot;class&quot;),t.begin=null,s.DONE):null!==/^\s/.exec(n)?(t.begin&amp;&amp;t.lastpos&amp;&amp;t.lastpos&gt;t.begin&amp;&amp;t.addEvent(t.begin+1,t.lastpos,&quot;class&quot;),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_KEY]=function(t,e){const n=t.subject.substr(e,1);return&quot;=&quot;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin,t.lastpos,&quot;key&quot;),t.begin=null,s.SCANNING_VALUE):null!==/^[a-zA-Z0-9_:-]/.exec(n)?s.SCANNING_KEY:s.FAIL},i[s.SCANNING_VALUE]=function(t,e){const n=t.subject.charAt(e);return&#39;&quot;&#39;===n?(t.begin=e,s.SCANNING_QUOTED_VALUE):null!==/^[a-zA-Z0-9_:-]/.exec(n)?(t.begin=e,s.SCANNING_BARE_VALUE):s.FAIL},i[s.SCANNING_BARE_VALUE]=function(t,e){const n=t.subject.charAt(e);return null!==/^[a-zA-Z0-9_:-]/.exec(n)?s.SCANNING_BARE_VALUE:&quot;}&quot;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin,t.lastpos,&quot;value&quot;),t.begin=null,s.DONE):/^\s/.exec(n)&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin,t.lastpos,&quot;value&quot;),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_ESCAPED]=function(t,e){return s.SCANNING_QUOTED_VALUE},i[s.SCANNING_ESCAPED_IN_CONTINUATION]=function(t,e){return s.SCANNING_QUOTED_VALUE_CONTINUATION},i[s.SCANNING_QUOTED_VALUE]=function(t,e){const n=t.subject.charAt(e);return&#39;&quot;&#39;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin+1,t.lastpos,&quot;value&quot;),t.begin=null,s.SCANNING):&quot;\n&quot;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin+1,e,&quot;value&quot;),t.begin=null,s.SCANNING_QUOTED_VALUE_CONTINUATION):&quot;\\&quot;===n?s.SCANNING_ESCAPED:s.SCANNING_QUOTED_VALUE},i[s.SCANNING_QUOTED_VALUE_CONTINUATION]=function(t,e){const n=t.subject.charAt(e);return null===t.begin&amp;&amp;(t.begin=e),&#39;&quot;&#39;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin,t.lastpos,&quot;value&quot;),t.begin=null,s.SCANNING):&quot;\n&quot;===n&amp;&amp;t.begin&amp;&amp;t.lastpos?(t.addEvent(t.begin,e,&quot;value&quot;),t.begin=null,s.SCANNING_QUOTED_VALUE_CONTINUATION):&quot;\\&quot;===n?s.SCANNING_ESCAPED_IN_CONTINUATION:s.SCANNING_QUOTED_VALUE_CONTINUATION},e.AttributeParser=class{constructor(t){this.subject=t,this.state=s.START,this.begin=null,this.lastpos=null,this.matches=[]}addEvent(t,e,s){this.matches.push({startpos:t,endpos:e,annot:s})}feed(t,e){let n=t;for(;n&lt;=e;){if(this.state=i[this.state](this,n),this.state===s.DONE)return{status:&quot;done&quot;,position:n};if(this.state===s.FAIL)return this.lastpos=n,{status:&quot;fail&quot;,position:n};this.lastpos=n,n+=1}return{status:&quot;continue&quot;,position:e}}}},155:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.parseEvents=void 0;const n=s(380),i=s(722),r=s(481),a=s(418),o=function(t){return&quot;+&quot;===t||&quot;-&quot;===t||&quot;*&quot;===t||&quot;:&quot;===t?[t]:/^[+*-] \[[Xx ]\]/.exec(t)?[&quot;X&quot;]:/^[(]?[0-9]+[).]/.exec(t)?[t.replace(/[0-9]+/,&quot;1&quot;)]:/^[(]?[ivxlcdm][).]/.exec(t)?[t.replace(/[a-z]+/,&quot;i&quot;),t.replace(/[a-z]+/,&quot;a&quot;)]:/^[(]?[IVXLCDM][).]/.exec(t)?[t.replace(/[A-Z]+/,&quot;I&quot;),t.replace(/[A-Z]+/,&quot;A&quot;)]:/^[(]?[ivxlcdm]+[).]/.exec(t)?[t.replace(/[a-z]+/,&quot;i&quot;)]:/^[(]?[IVXLCDM]+[).]/.exec(t)?[t.replace(/[A-Z]+/,&quot;I&quot;)]:/^[(]?[a-z][).]/.exec(t)?[t.replace(/[a-z]/,&quot;a&quot;)]:/^[(]?[A-Z][).]/.exec(t)?[t.replace(/[A-Z]/,&quot;A&quot;)]:[]},c=(0,r.pattern)(&quot;[ \\t]*\\r?\\n&quot;),l=(0,r.pattern)(&quot;^\\w+\\s&quot;),h=(0,r.pattern)(&quot;[ \\t\\r\\n]&quot;),d=(0,r.pattern)(&quot;[^ \\t\\r\\n]+&quot;),u=(0,r.pattern)(&quot;[&gt;][ \\t\\r\\n]&quot;),p=(0,r.pattern)(&quot;#+&quot;),f=(0,r.pattern)(&quot;(~~~~*|````*)([ \\t]*)([^ \\t\\r\\n`]*)[ \\t]*\\r?\\n&quot;),b=(0,r.pattern)(&quot;(:?)--*(:?)([ \\t]*\\|[ \\t]*)&quot;),g=(0,r.pattern)(&quot;[^`|\\r\\n]*(?:[|]|`+)&quot;),m=(0,r.pattern)(&quot;\\^[ \\t]+&quot;),_=(0,r.pattern)(&quot;\\[\\^([^\\]]+)\\]:[ \\t\\r\\n]&quot;),k=(0,r.pattern)(&quot;[-*][ \t]*[-*][ \\t]*[-*][-* \\t]*\\r?\\n&quot;),N=(0,r.pattern)(&quot;(::::*)[ \\t]*\\r?\\n&quot;),x=(0,r.pattern)(&quot;(::::*)[ \\t]*&quot;),C=(0,r.pattern)(&quot;([\\w_-]*)[ \\t]*\\r?\\n&quot;),A=(0,r.pattern)(&quot;\\[([^\\]\\r\\n]*)\\]:[ \\t]*([^ \\t\\r\\n]*)[\\r\\n]&quot;),P=(0,r.pattern)(&quot;(\\|[^\\r\\n]*\\|)[ \\t]*\\r?\\n&quot;),I=(0,r.pattern)(&quot;(:?[-*+:]|\\([0-9]+\\)|[0-9]+[.)]|[ivxlcdmIVXLCDM]+[.)]|\\([ivxlcdmIVXLCDM]+\\)|[a-zA-Z][.)]|\\([a-zA-Z]\\))[ \\t\\r\\n]&quot;),M=(0,r.pattern)(&quot;[*+-] \\[[Xx ]\\][ \\t\\r\\n]&quot;);var w;!function(t){t[t.None=0]=&quot;None&quot;,t[t.Inline=1]=&quot;Inline&quot;,t[t.Block=2]=&quot;Block&quot;,t[t.Text=3]=&quot;Text&quot;,t[t.Cells=4]=&quot;Cells&quot;,t[t.Attributes=5]=&quot;Attributes&quot;,t[t.ListItem=6]=&quot;ListItem&quot;}(w||(w={}));class v{constructor(t,e){this.name=t.name,this.type=t.type,this.content=t.content,this.continue=t.continue,this.close=t.close,this.indent=0,this.inlineParser=null,this.attributeParser=null,this.extra=e}}class S{constructor(t,e={}){&quot;\n&quot;!==t.charAt(t.length-1)&amp;&amp;(t+=&quot;\n&quot;),this.subject=t,this.maxoffset=t.length-1,this.options=e,this.warn=e.warn||(()=&gt;{}),this.indent=0,this.startline=0,this.starteol=0,this.endeol=0,this.matches=[],this.containers=[],this.pos=0,this.lastMatchedContainer=0,this.finishedLine=!1,this.returned=0,this.paraSpec={name:&quot;para&quot;,type:w.Block,content:w.Inline,continue:t=&gt;null===this.find(h),open:t=&gt;(this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,&quot;+para&quot;),!0),close:()=&gt;{this.getInlineMatches(),this.containers.pop();const t=this.matches[this.matches.length-1],e=t&amp;&amp;t.endpos+1||this.pos;this.addMatch(e,e,&quot;-para&quot;)}},this.specs=[{name:&quot;block_quote&quot;,type:w.Block,content:w.Block,continue:t=&gt;null!==this.find(u)&amp;&amp;(this.pos=this.pos+1,!0),open:t=&gt;null!==this.find(u)&amp;&amp;(this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,&quot;+block_quote&quot;),this.pos=this.pos+1,!0),close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-block_quote&quot;)}},{name:&quot;heading&quot;,type:w.Block,content:w.Inline,continue:t=&gt;{const e=this.find(p);return!(!e||t.extra.level!==e.endpos-e.startpos+1||!(0,r.find)(this.subject,h,e.endpos+1)||(this.pos=e.endpos+1,0))},open:t=&gt;{const e=this.find(p);if(e&amp;&amp;(0,r.find)(this.subject,h,e.endpos+1)){const s=e.endpos-e.startpos+1;return this.addContainer(new v(t,{level:s})),this.addMatch(e.startpos,e.endpos,&quot;+heading&quot;),this.pos=e.endpos+1,!0}return!1},close:()=&gt;{this.getInlineMatches(),this.containers.pop();const t=this.matches[this.matches.length-1],e=t&amp;&amp;t.endpos+1||this.pos;this.addMatch(e,e,&quot;-heading&quot;)}},{name:&quot;caption&quot;,type:w.Block,content:w.Inline,continue:t=&gt;null===(0,r.find)(this.subject,h,this.pos),open:t=&gt;{const e=this.find(m);return!!e&amp;&amp;(this.pos=e.endpos+1,this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,&quot;+caption&quot;),!0)},close:()=&gt;{this.getInlineMatches(),this.containers.pop(),this.addMatch(this.pos-1,this.pos-1,&quot;-caption&quot;)}},{name:&quot;footnote&quot;,type:w.Block,content:w.Block,continue:t=&gt;this.indent&gt;(t.extra.indent||0)||this.pos===this.starteol,open:t=&gt;{const e=this.find(_);if(e){const s=e.startpos,n=e.endpos,i=e.captures[0];return this.addContainer(new v(t,{note_label:i,indent:this.indent})),this.addMatch(s,s,&quot;+footnote&quot;),this.addMatch(s+2,n-3,&quot;note_label&quot;),this.pos=n,!0}return!1},close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-footnote&quot;)}},{name:&quot;reference_definition&quot;,type:w.Block,content:w.None,continue:t=&gt;{if(t.extra.indent&gt;=this.indent)return!1;const e=this.find(d);return!!(this.pos&lt;this.starteol&amp;&amp;e&amp;&amp;e.endpos===this.starteol-1)&amp;&amp;(this.addMatch(this.pos,this.starteol-1,&quot;reference_value&quot;),this.pos=this.starteol,!0)},open:t=&gt;{const e=this.find(A);if(e){const s=e.captures[0],n=e.captures[1];return this.addContainer(new v(t,{key:s,indent:this.indent})),this.addMatch(e.startpos,e.startpos,&quot;+reference_definition&quot;),this.addMatch(e.startpos,e.startpos+s.length+1,&quot;reference_key&quot;),n.length&gt;0&amp;&amp;this.addMatch(this.starteol-n.length,this.starteol-1,&quot;reference_value&quot;),this.pos=this.starteol-1,!0}return!1},close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-reference_definition&quot;)}},{name:&quot;thematic_break&quot;,type:w.Block,content:w.None,continue:t=&gt;!1,open:t=&gt;{const e=this.find(k);return!!e&amp;&amp;(this.addContainer(new v(t,{})),this.addMatch(e.startpos,e.endpos,&quot;thematic_break&quot;),this.pos=e.endpos,!0)},close:()=&gt;{this.containers.pop()}},{name:&quot;list&quot;,type:w.Block,content:w.ListItem,continue:t=&gt;{if(this.indent&gt;t.extra.indent||this.pos===this.starteol)return!0;{const e=this.find(I);if(null===e)return!1;let s=this.subject.substring(e.startpos,e.endpos);const n=this.find(M);null!==n&amp;&amp;(s=this.subject.substring(n.startpos,n.startpos+5));const i=o(s),r=[];for(const e of t.extra.styles)i.includes(e)&amp;&amp;r.push(e);if(r.length&gt;0)return t.extra.styles=r,!0}return!1},open:t=&gt;{const e=this.find(I);if(null===e)return!1;const s=e.startpos,n=e.endpos;let i=this.subject.substring(s,n);const r=this.find(M);null!==r&amp;&amp;(i=this.subject.substring(r.startpos,r.startpos+5));const a=o(i);if(0===a.length)return!1;const c={styles:a,indent:this.indent};this.addContainer(new v(t,c));let l=&quot;+list&quot;;for(const t of a)l=l+&quot;|&quot;+t;return this.addMatch(s,n-1,l),!0},close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-list&quot;)}},{name:&quot;list_item&quot;,type:w.ListItem,content:w.Block,continue:t=&gt;this.indent&gt;t.extra.indent||this.pos===this.starteol,open:t=&gt;{const e=this.find(I);if(null===e)return!1;const s=e.startpos,n=e.endpos;let i=this.subject.substring(s,n),r=null;const a=this.find(M);null!==a&amp;&amp;(i=this.subject.substring(a.startpos,a.startpos+5),r=this.subject.substring(a.startpos+3,a.startpos+4));const c=o(i);if(0===c.length)return!1;const l={styles:c,indent:this.indent};this.addContainer(new v(t,l));let h=&quot;+list_item&quot;;for(const t of c)h=h+&quot;|&quot;+t;return this.addMatch(s,n-1,h),this.pos=n,r&amp;&amp;(&quot; &quot;===r?this.addMatch(s+2,s+4,&quot;checkbox_unchecked&quot;):this.addMatch(s+2,s+4,&quot;checkbox_checked&quot;),this.pos=s+5),!0},close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-list_item&quot;)}},{name:&quot;table&quot;,type:w.Block,content:w.Cells,continue:t=&gt;{const e=this.find(P);if(e){const t=e.captures[0];return this.parseTableRow(e.startpos,e.startpos+t.length-1)}return!1},open:t=&gt;{const e=this.find(P);if(e){this.addContainer(new v(t,{columns:0}));const s=e.captures[0];return this.addMatch(e.startpos,e.startpos,&quot;+table&quot;),!!this.parseTableRow(e.startpos,e.startpos+s.length-1)||(this.matches.pop(),this.containers.pop(),!1)}return!1},close:()=&gt;{this.containers.pop(),this.addMatch(this.pos,this.pos,&quot;-table&quot;)}},{name:&quot;attributes&quot;,type:w.Block,content:w.Attributes,open:t=&gt;{if(123===this.subject.codePointAt(this.pos)){const e=new i.AttributeParser(this.subject),s=e.feed(this.pos,this.starteol);if(&quot;fail&quot;===s.status)return!1;if(&quot;done&quot;===s.status&amp;&amp;null===(0,r.find)(this.subject,c,s.position+1))return!1;{const n=this.addContainer(new v(t,{status:s.status,indent:this.indent,startpos:this.pos,slices:[]}));return n.attributeParser=e,n.extra.slices=[{startpos:this.pos,endpos:this.starteol}],this.pos=this.starteol,!0}}return!1},continue:t=&gt;{if(&quot;done&quot;===t.extra.status)return!1;if(t.attributeParser&amp;&amp;this.indent&gt;t.extra.indent){t.extra.slices.push({startpos:this.pos,endpos:this.starteol});const e=t.attributeParser.feed(this.pos,this.endeol);if(t.extra.status=e.status,&quot;fail&quot;!==e.status||!(0,r.find)(this.subject,c,e.position+1))return this.pos=this.starteol,!0}this.addMatch(t.extra.startpos,t.extra.startpos,&quot;+para&quot;);const e=this.containers.pop(),s=this.addContainer(new v(this.paraSpec,{}));if(!s.inlineParser||!e)throw new Error(&quot;Missing inlineParser or attrContainer&quot;);return s.inlineParser.attributeSlices=e.extra.slices,s.inlineParser.reparseAttributes(),this.pos=s.inlineParser.lastpos+1,!0},close:()=&gt;{const t=this.containers.pop();if(t)if(&quot;continue&quot;===t.extra.status){this.addMatch(t.extra.startpos,t.extra.startpos,&quot;+para&quot;);const e=this.addContainer(new v(this.paraSpec,{}),!0);if(!e||!e.inlineParser)throw new Error(&quot;Could not add paragraph&quot;);e.inlineParser.attributeSlices=t.extra.slices,e.inlineParser.reparseAttributes(),e.close()}else{if(this.addMatch(t.extra.startpos,t.extra.startpos,&quot;+block_attributes&quot;),t.attributeParser){const e=t.attributeParser.matches;for(const t of e)this.matches.push(t)}this.addMatch(this.pos,this.pos,&quot;-block_attributes&quot;)}}},{name:&quot;fenced_div&quot;,type:w.Block,content:w.Block,continue:t=&gt;{const e=this.tip();if(e&amp;&amp;&quot;code_block&quot;===e.name)return!0;const s=this.find(N);if(s&amp;&amp;t.extra.colons){const e=s.captures[0];if(e.length&gt;=t.extra.colons)return t.extra.endFenceStartpos=s.startpos,t.extra.endFenceEndpos=s.startpos+e.length-1,this.pos=s.endpos,!1}return!0},open:t=&gt;{const e=this.find(x);if(!e)return!1;const s=e.captures[0],n=(0,r.find)(this.subject,C,e.endpos+1);if(!n)return!1;const i=n.startpos,a=n.captures[0];return this.addContainer(new v(t,{colons:s.length})),this.addMatch(e.startpos,e.endpos,&quot;+div&quot;),a.length&gt;0&amp;&amp;this.addMatch(i,i+a.length-1,&quot;class&quot;),this.pos=n.endpos+1,this.finishedLine=!0,!0},close:()=&gt;{const t=this.containers.pop();if(!t)return;const e=t.extra.endFenceStartpos||this.pos,s=t.extra.endFenceEndpos||this.pos;this.addMatch(e,s,&quot;-div&quot;),e===s&amp;&amp;this.warn(new n.Warning(&quot;Unclosed div&quot;,this.pos))}},{name:&quot;code_block&quot;,type:w.Block,content:w.Text,continue:t=&gt;{const e=this.find(t.extra.closePattern);return!e||(t.extra.endFenceStartpos=e.startpos,t.extra.endFenceEndpos=e.startpos+e.captures[0].length-1,this.pos=e.endpos,this.finishedLine=!0,!1)},open:t=&gt;{const e=this.find(f);if(e){const[s,n,i]=e.captures,a=&quot;=&quot;===i.charAt(0),o=(0,r.pattern)(&quot;(&quot;+s+s.substring(0,1)+&quot;*)[ \\t]*[\\r\\n]&quot;);if(this.addContainer(new v(t,{closePattern:o})).indent=this.indent,this.addMatch(e.startpos,e.startpos+s.length-1,&quot;+code_block&quot;),i.length&gt;0){const t=e.startpos+s.length+n.length;a?this.addMatch(t,t+i.length-1,&quot;raw_format&quot;):this.addMatch(t,t+i.length-1,&quot;code_language&quot;)}return this.pos=e.endpos,this.finishedLine=!0,!0}return!1},close:()=&gt;{const t=this.containers.pop();if(!t)return;const e=t.extra.endFenceStartpos||this.pos,s=t.extra.endFenceEndpos||this.pos;this.addMatch(e,s,&quot;-code_block&quot;),e===s&amp;&amp;this.warn(new n.Warning(&quot;Unclosed code block&quot;,this.pos))}}]}find(t){return(0,r.find)(this.subject,t,this.pos)}tip(){return this.containers.length&gt;=1?this.containers[this.containers.length-1]:null}addMatch(t,e,s){this.matches.push({startpos:Math.min(t,this.maxoffset),endpos:Math.min(e,this.maxoffset),annot:s})}getInlineMatches(){var t;const e=null===(t=this.tip())||void 0===t?void 0:t.inlineParser;if(e){let t;for(const s of e.getMatches())t&amp;&amp;&quot;str&quot;===t.annot&amp;&amp;&quot;str&quot;===s.annot&amp;&amp;s.startpos===t.endpos+1?this.matches[this.matches.length-1].endpos=s.endpos:this.matches.push(s),t=s}}closeUnmatchedContainers(){const t=this.lastMatchedContainer;let e=this.tip();for(;e&amp;&amp;this.containers.length-1&gt;t;)e.close(),e=this.tip()}addContainer(t,e){e||this.closeUnmatchedContainers();let s=this.tip();for(;s&amp;&amp;s.content!==t.type;)s.close(),s=this.tip();return t.content===w.Inline&amp;&amp;(t.inlineParser=new a.InlineParser(this.subject,{warn:this.warn})),this.containers.push(t),t}skipSpace(){const t=this.subject;let e=this.pos;for(;32===(s=t.codePointAt(e))||9===s;)e++;var s;this.indent=e-this.startline,this.pos=e}getEol(){const t=this.subject;let e=this.pos;for(;10!==(s=t.codePointAt(e))&amp;&amp;13!==s;)e++;var s;this.starteol=e,13===t.codePointAt(e)&amp;&amp;10===t.codePointAt(e+1)?this.endeol=e+1:this.endeol=e}parseTableCell(){const t=new a.InlineParser(this.subject,{warn:this.warn});let e=!1;const s=this.pos-1;let n=s;for(this.skipSpace();!e;){const s=this.find(g);if(null===s){e=!1;break}{const i=s.endpos;&quot;`&quot;===this.subject.charAt(i)||t.inVerbatim()||&quot;\\&quot;===this.subject.charAt(i-1)?t.feed(this.pos,i):(t.feed(this.pos,i-1),n=i,e=!0),this.pos=i+1}}return e?{startpos:s,endpos:n,matches:t.getMatches()}:null}parseTableRow(t,e){const s=this.matches.length,n=this.pos;this.addMatch(t,t,&quot;+row&quot;),this.pos++;const i=[];let a=this.pos,o=!1;for(;!o;){const t=(0,r.find)(this.subject,b,a);if(null===t)break;{const[e,s,n]=t.captures;let r=&quot;separator_default&quot;;if(e.length&gt;0&amp;&amp;s.length&gt;0?r=&quot;separator_center&quot;:s.length&gt;0?r=&quot;separator_right&quot;:e.length&gt;0&amp;&amp;(r=&quot;separator_left&quot;),i.push({startpos:t.startpos,endpos:t.endpos-n.length,annot:r}),a=t.endpos+1,a===this.starteol){o=!0;break}}}if(o){for(const t of i)this.addMatch(t.startpos,t.endpos,t.annot);return this.addMatch(this.starteol-1,this.starteol-1,&quot;-row&quot;),this.pos=this.starteol,this.finishedLine=!0,!0}for(;this.pos&lt;=e;){const t=this.parseTableCell();if(null===t){for(this.pos=n;this.matches.length&gt;s;)this.matches.pop();return!1}{this.addMatch(t.startpos,t.startpos,&quot;+cell&quot;);const e=t.matches;e.forEach(((t,s)=&gt;{const n=t.startpos;let i=t.endpos;if(s===e.length-1&amp;&amp;&quot;str&quot;===t.annot)for(;32===this.subject.codePointAt(i)&amp;&amp;i&gt;=n;)i-=1;this.addMatch(n,i,t.annot)})),this.addMatch(t.endpos,t.endpos,&quot;-cell&quot;)}}return this.addMatch(this.pos,this.pos,&quot;-row&quot;),this.pos=this.starteol,this.finishedLine=!0,!0}[Symbol.iterator](){const t=this.specs,e=this.subject.length;this.returned=0;const s=this;return{next(){for(;s.pos&lt;e;){if(s.matches.length&gt;0&amp;&amp;s.returned&lt;s.matches.length)return s.returned=s.returned+1,{value:s.matches[s.returned-1],done:!1};s.indent=0,s.startline=s.pos,s.finishedLine=!1,s.getEol(),s.lastMatchedContainer=-1;let e=0;for(;e&lt;s.containers.length;){const t=s.containers[e];if(s.skipSpace(),!t.continue(t))break;s.lastMatchedContainer=e,e+=1}if(s.finishedLine)for(;s.containers.length&gt;0&amp;&amp;s.lastMatchedContainer&lt;s.containers.length-1;){const t=s.tip();t&amp;&amp;t.close()}if(!s.finishedLine){s.skipSpace();let e=s.pos===s.starteol,n=!1,i=s.containers[s.lastMatchedContainer],r=!(e||i&amp;&amp;i.content!==w.Block&amp;&amp;i.content!==w.ListItem||s.find(l));for(;r;){r=!1;for(const e of t)if((!i&amp;&amp;e.type===w.Block||i&amp;&amp;i.content===e.type)&amp;&amp;e.open(e)){if(!s.tip())throw new Error(&quot;No tip after opening container&quot;);s.lastMatchedContainer=s.containers.length-1,i=s.containers[s.lastMatchedContainer],s.finishedLine?r=!1:(s.skipSpace(),n=!0,r=e.content===w.Block||e.content===w.ListItem);break}}if(!s.finishedLine){s.skipSpace(),e=s.pos===s.starteol;let t=s.tip();if(!e&amp;&amp;!n&amp;&amp;s.lastMatchedContainer&lt;s.containers.length-1&amp;&amp;t&amp;&amp;t.content===w.Inline||s.closeUnmatchedContainers(),t=s.tip(),t&amp;&amp;t.content!==w.Block||(e?n||s.addMatch(s.pos,s.endeol,&quot;blankline&quot;):(s.paraSpec.open(s.paraSpec),t=s.tip(),t&amp;&amp;(t.inlineParser=new a.InlineParser(s.subject,s.options)))),t&amp;&amp;t.content===w.Text){let e=s.pos;null!==t.indent&amp;&amp;s.indent&gt;t.indent&amp;&amp;(e-=s.indent-t.indent),s.addMatch(e,s.endeol,&quot;str&quot;)}else t&amp;&amp;t.content===w.Inline&amp;&amp;!e&amp;&amp;t.inlineParser&amp;&amp;t.inlineParser.feed(s.pos,s.endeol)}}s.pos=(s.endeol||s.pos)+1}return s.lastMatchedContainer=-1,s.closeUnmatchedContainers(),s.matches.length&gt;0&amp;&amp;s.returned&lt;s.matches.length?(s.returned=s.returned+1,{value:s.matches[s.returned-1],done:!1}):{value:{startpos:s.pos,endpos:s.pos,annot:&quot;&quot;},done:!0}}}}}e.parseEvents=function(t,e={}){return new S(t,e)}},423:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.renderDjot=void 0;const n=s(60),i=s(306),r=function(t){const e=t.tag;return&quot;space&quot;===e||&quot;soft_break&quot;===e||&quot;hard_break&quot;===e},a=function(t,e){const s=t.text.match(/(`+)/g),n={};if(s)for(const t in s)n[s[t].length]=!0;let i=e;for(;n[i];)i++;return&quot;`&quot;.repeat(i)},o=function(t){if(t&lt;0||t&gt;=4e3)return&quot;?&quot;;let e=&quot;&quot;;for(;t&gt;0;)if(t&gt;=1e3)e+=&quot;M&quot;,t-=1e3;else if(t&gt;=900)e+=&quot;CM&quot;,t-=900;else if(t&gt;=500)e+=&quot;D&quot;,t-=500;else if(t&gt;=400)e+=&quot;CD&quot;,t-=400;else if(t&gt;=100)e+=&quot;C&quot;,t-=100;else if(t&gt;=90)e+=&quot;XC&quot;,t-=90;else if(t&gt;=50)e+=&quot;L&quot;,t-=50;else if(t&gt;=40)e+=&quot;XL&quot;,t-=40;else if(t&gt;=10)e+=&quot;X&quot;,t-=10;else if(9==t)e+=&quot;IX&quot;,t-=9;else if(t&gt;=5)e+=&quot;V&quot;,t-=5;else if(4==t)e+=&quot;IV&quot;,t-=4;else{if(!(t&gt;=1))throw new Error(&quot;toRoman encountered x = &quot;+t);e+=&quot;I&quot;,t-=1}return e},c=function(t,e){const s=e.replace(/[a-zA-Z0-9]+/g,&quot;$&quot;);let n;switch(e.replace(/[.()]/g,&quot;&quot;)){case&quot;1&quot;:n=t.toString();break;case&quot;a&quot;:n=String.fromCodePoint(96+t%26);break;case&quot;A&quot;:n=String.fromCodePoint(64+t%26);break;case&quot;i&quot;:n=o(t).toLowerCase();break;case&quot;I&quot;:n=o(t);break;default:throw new Error(&quot;formatNumber encountered unknown style &quot;+e)}return s.replace(&quot;$&quot;,n)};class l{constructor(t,e={}){this.prefixes=[],this.buffer=[],this.startOfLine=!0,this.endOfPrefix=0,this.column=0,this.needsBlankLine=!1,this.handlers={doc:t=&gt;{this.renderChildren(t.children),this.prefixes=[],this.cr(),Object.keys(t.references).length&gt;0&amp;&amp;(this.cr(),this.newline());for(const e in t.references)this.renderNode(t.references[e]);Object.keys(t.footnotes).length;for(const e in t.footnotes)this.renderNode(t.footnotes[e]);this.prefixes=[],this.cr()},footnote:t=&gt;{this.lit(&quot;[^&quot;+t.label+&quot;]:&quot;),this.space(),this.needsBlankLine=!1,this.prefixes.push(&quot;  &quot;),this.renderChildren(t.children),this.prefixes.pop(),this.blankline()},reference:t=&gt;{this.lit(&quot;[&quot;),this.lit(t.label),this.lit(&quot;]:&quot;),this.prefixes.push(&quot;  &quot;),this.space(),this.lit(t.destination),this.wrap(),this.prefixes.pop(),this.blankline()},para:t=&gt;{this.renderChildren(t.children),this.blankline()},thematic_break:()=&gt;{this.lit(&quot;* * * * *&quot;),this.blankline()},div:t=&gt;{this.lit(&quot;:::&quot;),this.cr(),this.renderChildren(t.children),this.cr(),this.lit(&quot;:::&quot;),this.blankline()},heading:t=&gt;{const e=&quot;#&quot;.repeat(t.level);this.lit(e+&quot; &quot;),this.prefixes.push(e+&quot; &quot;),this.renderChildren(t.children),this.prefixes.pop(),this.blankline()},block_quote:t=&gt;{this.prefixes.push(&quot;&gt; &quot;),this.lit(&quot;&gt; &quot;),this.renderChildren(t.children),this.prefixes.pop(),this.blankline()},section:t=&gt;{this.renderChildren(t.children)},code_block:t=&gt;{const e=a(t,3);this.lit(e),t.lang&amp;&amp;this.lit(&quot; &quot;+t.lang),this.cr(),this.litlines(t.text),this.cr(),this.lit(e),this.blankline()},raw_block:t=&gt;{const e=a(t,3);this.lit(e),this.lit(&quot; =&quot;+t.format),this.cr(),this.litlines(t.text),this.cr(),this.lit(e),this.blankline()},definition_list:t=&gt;{const e=t.children;for(let t=0;t&lt;e.length;t++){const s=e[t];t&gt;0&amp;&amp;this.newline(),this.lit(&quot;:&quot;),this.needsBlankLine=!1,this.space(),this.prefixes.push(&quot; &quot;.repeat(2)),this.renderChildren(s.children),this.prefixes.pop()}},ordered_list:t=&gt;{const e=t.style,s=t.start||1,n=t.children,i=t.tight;for(let t=0;t&lt;n.length;t++){const r=n[t];t&gt;0&amp;&amp;(this.cr(),i||this.newline());const a=c(s+t,e);this.lit(a),this.needsBlankLine=!1,this.space(),this.prefixes.push(&quot; &quot;.repeat(a.length+1)),this.renderChildren(r.children),this.prefixes.pop()}i&amp;&amp;this.blankline()},bullet_list:t=&gt;{const e=t.children,s=t.tight;for(let n=0;n&lt;e.length;n++){const i=e[n];n&gt;0&amp;&amp;(this.cr(),s||this.newline());const r=t.style;this.lit(r),this.needsBlankLine=!1,this.space(),this.prefixes.push(&quot; &quot;.repeat(r.length+1)),this.renderChildren(i.children),this.prefixes.pop()}s&amp;&amp;this.blankline()},task_list:t=&gt;{const e=t.children,s=t.tight;for(let t=0;t&lt;e.length;t++){const n=e[t];t&gt;0&amp;&amp;(this.cr(),s||this.newline()),this.needsBlankLine=!1,this.lit(`- [${&quot;checked&quot;===n.checkbox?&quot;X&quot;:&quot; &quot;}]`),this.space(),this.prefixes.push(&quot; &quot;.repeat(2)),this.renderChildren(n.children),this.prefixes.pop()}s&amp;&amp;this.blankline()},term:t=&gt;{this.renderChildren(t.children),this.blankline()},definition:t=&gt;{this.renderChildren(t.children)},table:t=&gt;{const e=t.children.filter(n.isCaption),s=t.children.filter(n.isRow);for(let t=0;t&lt;s.length;t++){const e=s[t];if(&quot;head&quot;in e&amp;&amp;!e.head&amp;&amp;t&gt;0&amp;&amp;s[t-1].head){const e=s[t-1];for(let t=0;t&lt;e.children.length;t++){switch(0===t&amp;&amp;this.lit(&quot;|&quot;),e&amp;&amp;e.children[t].align){case&quot;left&quot;:this.lit(&quot;:--&quot;);break;case&quot;right&quot;:this.lit(&quot;--:&quot;);break;case&quot;center&quot;:this.lit(&quot;:-:&quot;);break;default:this.lit(&quot;---&quot;)}this.lit(&quot;|&quot;)}this.cr()}for(let t=0;t&lt;e.children.length;t++){const s=e.children[t];0===t&amp;&amp;this.lit(&quot;|&quot;),this.noWrap((()=&gt;{&quot;cell&quot;===s.tag&amp;&amp;this.renderChildren(s.children)})),this.lit(&quot;|&quot;)}this.cr()}e.length&gt;0&amp;&amp;e[0].children.length&gt;0&amp;&amp;(this.newline(),this.lit(&quot;^ &quot;),this.needsBlankLine=!1,this.prefixes.push(&quot;  &quot;),this.renderChildren(e[0].children),this.prefixes.pop(),this.blankline()),this.blankline()},str:t=&gt;{t.text.split(/  */).forEach(((t,e)=&gt;{e&gt;0&amp;&amp;this.space(),this.out(t)}))},space:()=&gt;{this.space()},soft_break:()=&gt;{this.soft_break()},smart_punctuation:t=&gt;{this.lit(t.text)},non_breaking_space:()=&gt;{this.lit(&quot;\\ &quot;)},single_quoted:this.inlineContainer(&quot;&#39;&quot;),double_quoted:this.inlineContainer(&#39;&quot;&#39;),emph:this.inlineContainer(&quot;_&quot;),strong:this.inlineContainer(&quot;*&quot;),superscript:this.inlineContainer(&quot;^&quot;),subscript:this.inlineContainer(&quot;~&quot;),mark:this.inlineContainer(&quot;=&quot;,!0),delete:this.inlineContainer(&quot;-&quot;,!0),insert:this.inlineContainer(&quot;+&quot;,!0),footnote_reference:t=&gt;{this.lit(&quot;[^&quot;+t.text+&quot;]&quot;)},symb:t=&gt;{this.lit(&quot;:&quot;+t.alias+&quot;:&quot;)},email:t=&gt;{this.lit(&quot;&lt;&quot;+t.text+&quot;&gt;&quot;)},url:t=&gt;{this.lit(&quot;&lt;&quot;+t.text+&quot;&gt;&quot;)},link:t=&gt;{this.lit(&quot;[&quot;),this.renderChildren(t.children),this.lit(&quot;]&quot;),t.reference?(this.lit(&quot;[&quot;),t.reference!==(0,i.getStringContent)(t)&amp;&amp;this.lit(t.reference),this.lit(&quot;]&quot;)):t.destination?(this.lit(&quot;(&quot;),this.lit(t.destination),this.lit(&quot;)&quot;)):this.lit(&quot;()&quot;)},image:t=&gt;{this.lit(&quot;![&quot;),this.renderChildren(t.children),this.lit(&quot;]&quot;),t.reference?(this.lit(&quot;[&quot;),t.reference!==(0,i.getStringContent)(t)&amp;&amp;this.lit(t.reference),this.lit(&quot;]&quot;)):t.destination?(this.lit(&quot;(&quot;),this.lit(t.destination),this.lit(&quot;)&quot;)):this.lit(&quot;()&quot;)},raw_inline:t=&gt;{this.verbatimNode(t),this.lit(&quot;{=&quot;+t.format+&quot;}&quot;)},verbatim:t=&gt;{this.verbatimNode(t)},inline_math:t=&gt;{this.lit(&quot;$&quot;),this.verbatimNode(t)},display_math:t=&gt;{this.lit(&quot;$$&quot;),this.verbatimNode(t)}},this.doc=t,this.wrapWidth=(null==e?void 0:e.wrapWidth)||0}escape(t){return t=t.replace(/([~`&#39;&quot;${}[\]^&lt;&gt;\\*_]|-(?=-)|!(=\[)|\.(?=\.))/g,&quot;\\$1&quot;),0!==this.column&amp;&amp;this.column!==this.endOfPrefix||(t=t.replace(/^#/,&quot;\\#&quot;)),t}out(t){this.lit(this.escape(t))}doBlankLines(){this.needsBlankLine&amp;&amp;(this.cr(),this.newline(),this.needsBlankLine=!1)}lit(t){this.buffer.push(t),this.column+=t.length,this.startOfLine=!1}blankline(){this.needsBlankLine=!0}newline(){if(this.endOfPrefix===this.column)for(;/  *$|^$/.test(this.buffer[this.buffer.length-1]);)this.buffer[this.buffer.length-1]=this.buffer[this.buffer.length-1].replace(/  *$/,&quot;&quot;),&quot;&quot;===this.buffer[this.buffer.length-1]&amp;&amp;this.buffer.pop();if(this.endOfPrefix=0,this.column=0,this.buffer.push(&quot;\n&quot;),this.prefixes.length&gt;0){for(let t=0,e=this.prefixes.length;t&lt;e;t++)this.buffer.push(this.prefixes[t]),this.column+=this.prefixes[t].length;this.endOfPrefix=this.column}this.startOfLine=!0}cr(){this.startOfLine||this.newline()}wrap(){if(this.wrapWidth&lt;=0)return;let t=this.buffer.length-1;if(!this.startOfLine&amp;&amp;this.buffer.length&gt;0&amp;&amp;this.column&gt;this.wrapWidth){let e;for(;t&gt;=0&amp;&amp;(e=this.buffer[t],&quot; &quot;!==e);){if(/^[ \r\n]+$/.test(e))return;t--}}if(t&lt;this.buffer.length-1){const e=this.buffer.splice(t+1);&quot; &quot;===this.buffer[this.buffer.length-1]&amp;&amp;this.buffer.pop(),this.newline(),this.startOfLine=!0;for(let t=0;t&lt;e.length;t++)this.buffer.push(e[t]),this.column+=e[t].length,this.startOfLine=!1}}space(){this.wrap(),this.lit(&quot; &quot;)}soft_break(){0===this.wrapWidth?this.newline():this.space()}needsBraces(t){return function(t){return t.children[0]&amp;&amp;r(t.children[0])}(t)||function(t){return t.children[0]&amp;&amp;r(t.children[t.children.length-1])}(t)||this.buffer.length&gt;0&amp;&amp;/\w$/.test(this.buffer[this.buffer.length-1])}noWrap(t){const e=this.wrapWidth;this.wrapWidth=-1,t(),this.wrapWidth=e}inlineContainer(t,e){const s=this;return function(n){(e=e||s.needsBraces(n))&amp;&amp;s.lit(&quot;{&quot;),s.lit(t),s.renderChildren(n.children),s.lit(t),e&amp;&amp;s.lit(&quot;}&quot;)}}litlines(t){const e=t.split(/\r?\n/);&quot;&quot;===e[e.length-1]&amp;&amp;e.pop();for(const t of e)this.lit(t),this.cr()}verbatimNode(t){const e=a(t,1);this.lit(e),/^`/.test(t.text)&amp;&amp;this.lit(&quot; &quot;),this.lit(t.text),/`$/.test(t.text)&amp;&amp;this.lit(&quot; &quot;),this.lit(e)}renderChildren(t){for(let e=0,s=t.length;e&lt;s;e++)this.renderNode(t[e]);t[0]&amp;&amp;!(0,n.isBlock)(t[0])&amp;&amp;this.wrap()}renderNode(t){this.doBlankLines();const e=this.handlers[t.tag];if(!e)throw new Error(&quot;No renderer defined for node type &quot;+t.tag);&quot;attributes&quot;in t&amp;&amp;(0,n.isBlock)(t)&amp;&amp;(this.renderAttributes(t),this.cr()),e(t),&quot;attributes&quot;in t&amp;&amp;(0,n.isInline)(t)&amp;&amp;this.renderAttributes(t)}renderAttributes(t){if(!t.attributes||0===Object.keys(t.attributes).length)return;const e=t.attributes;this.lit(&quot;{&quot;);let s=!0;(0,n.isBlock)(t)&amp;&amp;this.prefixes.push(&quot; &quot;);for(const t in e){if(s||this.space(),&quot;id&quot;===t)this.lit(&quot;#&quot;),this.lit(e[t]);else if(&quot;class&quot;===t){const s=e[t].split(/  */);for(let t=0;t&lt;s.length;t++)t&gt;0&amp;&amp;this.space(),this.lit(&quot;.&quot;),this.lit(s[t])}else this.lit(t),this.lit(&#39;=&quot;&#39;),this.out(e[t]),this.lit(&#39;&quot;&#39;);s=!1}(0,n.isBlock)(t)&amp;&amp;this.prefixes.pop(),this.lit(&quot;}&quot;)}render(){return this.renderNode(this.doc),this.buffer.join(&quot;&quot;)}}e.renderDjot=function(t,e={}){return new l(t,e).render()}},322:(t,e)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.applyFilter=void 0;class s{constructor(t){this.finished=!1,this.stack=[],this.enter=!0,this.top=t,this.current=t}walk(t){for(;!this.finished;){t(this);const e=this.stack&amp;&amp;this.stack[this.stack.length-1];if(this.enter=this.enter&amp;&amp;&quot;children&quot;in this.current,this.enter)&quot;children&quot;in this.current&amp;&amp;this.current.children.length&gt;0?(this.stack.push({node:this.current,childIndex:0}),this.current=this.current.children[0],this.enter=!0):this.enter=!1;else if(e){e.childIndex++;const t=e.node.children[e.childIndex];t?(this.current=t,this.enter=!0):(this.stack.pop(),this.current=e.node,this.enter=!1)}else this.finished=!0}}}const n=function(t,e){return new s(t).walk((t=&gt;{let s=function(t,e,s){if(!t||!t.tag)throw new Error(&quot;Filter called on a non-node.&quot;);const n=s[t.tag];if(!n)return!1;if(e&amp;&amp;&quot;enter&quot;in n){const e=n.enter;return!!e&amp;&amp;e(t)}{let e;if(e=&quot;exit&quot;in n&amp;&amp;n.exit?n.exit:&quot;enter&quot;in n&amp;&amp;n.enter?n.enter:n,&quot;function&quot;==typeof e)return e(t)}}(t.current,t.enter,e);const n=t.stack[t.stack.length-1];if(&quot;object&quot;==typeof s&amp;&amp;&quot;stop&quot;in s&amp;&amp;s.stop&amp;&amp;(s=s.stop,t.enter=!1),s)if(Array.isArray(s)){if(!n)throw Error(&quot;Cannot replace top node with multiple nodes&quot;);n.node.children.splice(n.childIndex,1,...s),t.current=n.node.children[n.childIndex],s.length&gt;1&amp;&amp;(n.childIndex+=s.length-1)}else if(&quot;object&quot;==typeof s&amp;&amp;&quot;tag&quot;in s&amp;&amp;s.tag){if(!n)return s;n.node.children[n.childIndex]=s}})),t};e.applyFilter=function(t,e){const s=e();let i;i=Array.isArray(s)?s:[s];for(const e of i){n(t,e);for(const s in t.footnotes)n(t.footnotes[s],e);for(const s in t.references)n(t.references[s],e)}}},481:(t,e)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.find=e.pattern=void 0,e.pattern=function(t){return new RegExp(t,&quot;yd&quot;)},e.find=function(t,e,s,n){let i;e.lastIndex=s,i=void 0!==n?t.substring(0,n+1):t;const r=e.exec(i);if(null!==r){const t=[];if(r.indices.length&gt;1)for(let e=1;e&lt;r.indices.length;e++){const[s,n]=r.indices[e];t.push(i.substring(s,n))}return{startpos:r.indices[0][0],endpos:r.indices[0][1]-1,captures:t}}return null}},240:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.HTMLRenderer=e.renderHTML=void 0;const n=s(306),i=s(380),r=/[&amp;&lt;&gt;]/,a=/[&amp;&lt;&gt;&quot;]/;class o{constructor(t){this.smartPunctuationMap={right_single_quote:&quot;’&quot;,left_single_quote:&quot;‘&quot;,right_double_quote:&quot;”&quot;,left_double_quote:&quot;“&quot;,ellipses:&quot;…&quot;,em_dash:&quot;—&quot;,en_dash:&quot;–&quot;},this.warn=t.warn||(()=&gt;{}),this.options=t||{},this.tight=!1,this.footnoteIndex={},this.nextFootnoteIndex=1,this.references={}}escape(t){return r.test(t)?t.replace(/&amp;/g,&quot;&amp;amp;&quot;).replace(/&lt;/g,&quot;&amp;lt;&quot;).replace(/&gt;/g,&quot;&amp;gt;&quot;):t}escapeAttribute(t){return a.test(t)?t.replace(/&amp;/g,&quot;&amp;amp;&quot;).replace(/&lt;/g,&quot;&amp;lt;&quot;).replace(/&gt;/g,&quot;&amp;gt;&quot;).replace(/&quot;/g,&quot;&amp;quot;&quot;):t}renderAttributes(t,e){let s=&quot;&quot;;if(e)for(const n in e)if(&quot;class&quot;===n){let i=e[n];t.attributes&amp;&amp;t.attributes.class&amp;&amp;(i=`${i} ${t.attributes.class}`),s+=` ${n}=&quot;${this.escapeAttribute(i)}&quot;`}else s+=` ${n}=&quot;${this.escapeAttribute(e[n])}&quot;`;if(t.attributes)for(const n in t.attributes){const i=t.attributes[n];&quot;class&quot;===n&amp;&amp;e&amp;&amp;e.class||(s+=` ${n}=&quot;${this.escapeAttribute(i)}&quot;`)}if(t.pos){const e=t.pos.start,n=t.pos.end;s+=` data-startpos=&quot;${e.line}:${e.col}:${e.offset}&quot; data-endpos=&quot;${n.line}:${n.col}:${n.offset}&quot;`}return s}renderTag(t,e,s){let n=&quot;&quot;;return(&quot;attributes&quot;in e||s||e.pos)&amp;&amp;(n=this.renderAttributes(e,s)),`&lt;${t}${n}&gt;`}renderCloseTag(t){return`&lt;/${t}&gt;`}inTags(t,e,s,n){const i=s&gt;=2?&quot;\n&quot;:&quot;&quot;,r=s&gt;=1?&quot;\n&quot;:&quot;&quot;;return`${this.renderTag(t,e,n)}${i}${this.renderChildren(e)}&lt;/${t}&gt;${r}`}addBacklink(t,e){const s=`&lt;a href=&quot;#fnref${e}&quot; role=&quot;doc-backlink&quot;&gt;↩︎︎&lt;/a&gt;`;return/\&lt;\/p\&gt;[\r\n]*$/.test(t)?t.replace(/\&lt;\/p\&gt;([\r\n]*)$/,s+&quot;&lt;/p&gt;$1&quot;):t+`&lt;p&gt;${s}&lt;/p&gt;\n`}renderChildren(t){let e=&quot;&quot;;const s=this.tight;&quot;tight&quot;in t&amp;&amp;(this.tight=!!t.tight);for(const s of t.children)e+=this.renderAstNode(s);return&quot;tight&quot;in t&amp;&amp;(this.tight=s),e}renderAstNode(t){var e;const s=null===(e=this.options.overrides)||void 0===e?void 0:e[t.tag];return s?s(t,this):this.renderAstNodeDefault(t)}renderNotes(t){let e=&quot;&quot;;const s=[],n={};for(const e in t)n[e]=this.renderChildren(t[e]);for(const t in this.footnoteIndex){const e=this.footnoteIndex[t];e&amp;&amp;(s[e]=n[t])}e+=&#39;&lt;section role=&quot;doc-endnotes&quot;&gt;\n&lt;hr&gt;\n&lt;ol&gt;\n&#39;;for(let t=1;t&lt;s.length;t++){const n=s[t]||&quot;&quot;;e+=`&lt;li id=&quot;fn${t}&quot;&gt;\n`,e+=this.addBacklink(n,t),e+=&quot;&lt;/li&gt;\n&quot;}return e+=&quot;&lt;/ol&gt;\n&lt;/section&gt;\n&quot;,e}renderAstNodeDefault(t){var e;switch(t.tag){case&quot;doc&quot;:{let e=&quot;&quot;;return e+=this.renderChildren(t),this.nextFootnoteIndex&gt;1&amp;&amp;(e+=this.renderNotes(t.footnotes)),e}case&quot;para&quot;:return this.tight?`${this.renderChildren(t)}\n`:this.inTags(&quot;p&quot;,t,1);case&quot;block_quote&quot;:return this.inTags(&quot;blockquote&quot;,t,2);case&quot;div&quot;:return this.inTags(&quot;div&quot;,t,2);case&quot;section&quot;:return this.inTags(&quot;section&quot;,t,2);case&quot;list_item&quot;:return this.inTags(&quot;li&quot;,t,2);case&quot;task_list_item&quot;:return this.inTags(&quot;li&quot;,t,2,{class:&quot;checked&quot;===t.checkbox?&quot;checked&quot;:&quot;unchecked&quot;});case&quot;definition_list_item&quot;:return this.renderChildren(t);case&quot;definition&quot;:return this.inTags(&quot;dd&quot;,t,2);case&quot;term&quot;:return this.inTags(&quot;dt&quot;,t,1);case&quot;definition_list&quot;:return this.inTags(&quot;dl&quot;,t,2);case&quot;bullet_list&quot;:return this.inTags(&quot;ul&quot;,t,2);case&quot;task_list&quot;:return this.inTags(&quot;ul&quot;,t,2,{class:&quot;task-list&quot;});case&quot;ordered_list&quot;:{const e={};return t.start&amp;&amp;1!==t.start&amp;&amp;(e.start=t.start.toString()),t.style&amp;&amp;!/1/.test(t.style)&amp;&amp;(e.type=t.style.replace(/[().]/g,&quot;&quot;)),this.inTags(&quot;ol&quot;,t,2,e)}case&quot;heading&quot;:return this.inTags(`h${t.level}`,t,1);case&quot;footnote_reference&quot;:{let e=&quot;&quot;;const s=t.text;let n=this.footnoteIndex[s];return n||(n=this.nextFootnoteIndex,this.footnoteIndex[s]=n,this.nextFootnoteIndex++),e+=this.renderTag(&quot;a&quot;,t,{id:&quot;fnref&quot;+n,href:&quot;#fn&quot;+n,role:&quot;doc-noteref&quot;}),e+=&quot;&lt;sup&gt;&quot;,e+=this.escape(n.toString()),e+=&quot;&lt;/sup&gt;&lt;/a&gt;&quot;,e}case&quot;table&quot;:return this.inTags(&quot;table&quot;,t,2);case&quot;caption&quot;:{let e=&quot;&quot;;return t.children.length&gt;0&amp;&amp;(e+=this.inTags(&quot;caption&quot;,t,1)),e}case&quot;row&quot;:return this.inTags(&quot;tr&quot;,t,2);case&quot;cell&quot;:{const e={};return t.align&amp;&amp;&quot;default&quot;!==t.align&amp;&amp;(e.style=`text-align: ${t.align};`),this.inTags(t.head?&quot;th&quot;:&quot;td&quot;,t,1,e)}case&quot;thematic_break&quot;:{let e=&quot;&quot;;return e+=this.renderTag(&quot;hr&quot;,t),e+=&quot;\n&quot;,e}case&quot;code_block&quot;:{let e=&quot;&quot;;return e+=this.renderTag(&quot;pre&quot;,t),e+=&quot;&lt;code&quot;,t.lang&amp;&amp;(e+=` class=&quot;language-${this.escapeAttribute(t.lang)}&quot;`),e+=&quot;&gt;&quot;,e+=this.escape(t.text),e+=this.renderCloseTag(&quot;code&quot;),e+=this.renderCloseTag(&quot;pre&quot;),e+=&quot;\n&quot;,e}case&quot;raw_block&quot;:{let e=&quot;&quot;;return&quot;html&quot;===t.format&amp;&amp;(e+=t.text),e}case&quot;str&quot;:return t.attributes?`${this.renderTag(&quot;span&quot;,t)}${this.escape(t.text)}&lt;/span&gt;`:this.escape(t.text);case&quot;smart_punctuation&quot;:return this.smartPunctuationMap[t.type]||t.text;case&quot;double_quoted&quot;:{let e=&quot;&quot;;return e+=this.smartPunctuationMap.left_double_quote||&#39;&quot;&#39;,e+=this.renderChildren(t),e+=this.smartPunctuationMap.right_double_quote||&#39;&quot;&#39;,e}case&quot;single_quoted&quot;:{let e=&quot;&quot;;return e+=this.smartPunctuationMap.left_single_quote||&quot;&#39;&quot;,e+=this.renderChildren(t),e+=this.smartPunctuationMap.right_single_quote||&quot;&#39;&quot;,e}case&quot;symb&quot;:return this.escape(`:${t.alias}:`);case&quot;inline_math&quot;:{let e=&quot;&quot;;return e+=this.renderTag(&quot;span&quot;,t,{class:&quot;math inline&quot;}),e+=`\\(${this.escape(t.text)}\\)`,e+=this.renderCloseTag(&quot;span&quot;),e}case&quot;display_math&quot;:{let e=&quot;&quot;;return e+=this.renderTag(&quot;span&quot;,t,{class:&quot;math display&quot;}),e+=`\\[${this.escape(t.text)}\\]`,e+=this.renderCloseTag(&quot;span&quot;),e}case&quot;verbatim&quot;:{let e=&quot;&quot;;return e+=this.renderTag(&quot;code&quot;,t),e+=this.escape(t.text),e+=this.renderCloseTag(&quot;code&quot;),e}case&quot;raw_inline&quot;:{let e=&quot;&quot;;return&quot;html&quot;===t.format&amp;&amp;(e+=t.text),e}case&quot;soft_break&quot;:return&quot;\n&quot;;case&quot;hard_break&quot;:return&quot;&lt;br&gt;\n&quot;;case&quot;non_breaking_space&quot;:return&quot;&amp;nbsp;&quot;;case&quot;link&quot;:case&quot;image&quot;:{const s={};let r=t.destination;if(t.reference){const a=this.references[t.reference];if(a){if(r=a.destination,&quot;image&quot;===t.tag?(s.alt=(0,n.getStringContent)(t),s.src=r):s.href=r,a.attributes)for(const e in a.attributes)t.attributes&amp;&amp;t.attributes[e]||(s[e]=a.attributes[e])}else this.warn(new i.Warning(`Reference ${JSON.stringify(t.reference)} not found`,null===(e=null==t?void 0:t.pos)||void 0===e?void 0:e.end))}else&quot;image&quot;===t.tag?(s.alt=(0,n.getStringContent)(t),void 0!==r&amp;&amp;(s.src=r)):void 0!==r&amp;&amp;(s.href=r);return&quot;image&quot;===t.tag?this.renderTag(&quot;img&quot;,t,s):this.inTags(&quot;a&quot;,t,0,s)}case&quot;url&quot;:case&quot;email&quot;:{let e=&quot;&quot;;const s={};return&quot;email&quot;===t.tag?s.href=&quot;mailto:&quot;+t.text:s.href=t.text,e+=this.renderTag(&quot;a&quot;,t,s),e+=this.escape(t.text),e+=this.renderCloseTag(&quot;a&quot;),e}case&quot;strong&quot;:return this.inTags(&quot;strong&quot;,t,0);case&quot;emph&quot;:return this.inTags(&quot;em&quot;,t,0);case&quot;span&quot;:return this.inTags(&quot;span&quot;,t,0);case&quot;mark&quot;:return this.inTags(&quot;mark&quot;,t,0);case&quot;insert&quot;:return this.inTags(&quot;ins&quot;,t,0);case&quot;delete&quot;:return this.inTags(&quot;del&quot;,t,0);case&quot;superscript&quot;:return this.inTags(&quot;sup&quot;,t,0);case&quot;subscript&quot;:return this.inTags(&quot;sub&quot;,t,0);default:return&quot;&quot;}}render(t){return this.references=t.references,this.renderAstNode(t)}}e.HTMLRenderer=o,e.renderHTML=function(t,e={}){return new o(e).render(t)}},418:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.InlineParser=void 0;const n=s(722),i=s(380),r=s(481),a=123,o=125,c=/[\r\n&quot;&#39;()*+.:&lt;=[\\\]^_`${}~-]/g,l=function(t,e,s){c.lastIndex=e;const n=c.exec(t);return n&amp;&amp;n.index&lt;=s?n.index:null},h=(0,r.pattern)(&quot;[^ \t\r\n]&quot;),d=(0,r.pattern)(&quot;[ \\t]*\\r?\\n&quot;),u=(0,r.pattern)(&quot;[&#39;!\&quot;#$%&amp;\\\\&#39;()\\*+,\\-\\.\\/:;&lt;=&gt;?@\\[\\]\\^_`{|}~&#39;]&quot;),p=(0,r.pattern)(&quot;\\&lt;([^&lt;&gt;\\s]+)\\&gt;&quot;),f=(0,r.pattern)(&quot;[_*~^+=&#39;\&quot;-]&quot;),b=(0,r.pattern)(&quot;:[\\w_+-]+:&quot;),g=(0,r.pattern)(&quot;\\.\\.&quot;),m=(0,r.pattern)(&quot;`*&quot;),_=(0,r.pattern)(&quot;`+&quot;),k=(0,r.pattern)(&quot;\\$\\$&quot;),N=(0,r.pattern)(&quot;\\$&quot;),x=(0,r.pattern)(&quot;\\\\&quot;),C=(0,r.pattern)(&quot;\\{=[^\\s{}`]+\\}&quot;),A=(0,r.pattern)(&quot;\\^([^\\]]+)\\]&quot;),P=function(t,e){return e&gt;0&amp;&amp;t.subject.codePointAt(e-1)===a||t.subject.codePointAt(e+1)===o},I=function(){return!0},M=function(t,e,s,n){return function(i,a,c){const l=i.subject;let d=null!==(0,r.find)(l,h,a+1)&amp;&amp;n(i,a),u=null!==(0,r.find)(l,h,a-1);const p=i.matches[i.matches.length-1],f=p&amp;&amp;&quot;open_marker&quot;===p.annot,b=a+1&lt;=c&amp;&amp;l.codePointAt(a+1)===o;let g=a,m=a;f&amp;&amp;(d=!0,u=!1,m=a-1),!f&amp;&amp;b&amp;&amp;(u=!0,d=!1,g=a+1),f&amp;&amp;s.match(/^right/)?s=s.replace(/^right/,&quot;left&quot;):b&amp;&amp;s.match(/^left/)&amp;&amp;(s=s.replace(/^left/,&quot;right&quot;));let _=t;b&amp;&amp;(_=&quot;{&quot;+_);const k=i.openers[_];if(u&amp;&amp;k&amp;&amp;k.length&gt;0){const t=k[k.length-1];if(t.endpos!==a-1)return i.clearOpeners(t.startpos,a),i.addMatch(t.startpos,t.endpos,&quot;+&quot;+e,t.matchIndex),i.addMatch(a,g,&quot;-&quot;+e),g+1}if(d){let e=t;return f&amp;&amp;(e=&quot;{&quot;+e),i.addOpener(e,m,a,s),a+1}return i.addMatch(a,g,s),g+1}},w={96:function(t,e,s){const n=t.subject,i=(0,r.find)(n,m,e,s);if(null===i)return null;const a=i.endpos;return(0,r.find)(n,k,e-2)&amp;&amp;!(0,r.find)(n,x,e-3)?(t.matches.pop(),t.matches.pop(),t.addMatch(e-2,a,&quot;+display_math&quot;),t.verbatimType=&quot;display_math&quot;):(0,r.find)(n,N,e-1)?(t.matches.pop(),t.addMatch(e-1,a,&quot;+inline_math&quot;),t.verbatimType=&quot;inline_math&quot;):(t.addMatch(e,a,&quot;+verbatim&quot;),t.verbatimType=&quot;verbatim&quot;),t.verbatim=a-e+1,a+1},92:function(t,e,s){const n=t.subject,i=(0,r.find)(n,d,e+1,s);if(null!==i){if(t.matches.length&gt;0){const e=t.matches[t.matches.length-1];if(&quot;str&quot;===e.annot){let s=e.endpos;const i=e.startpos;for(;s&gt;=i&amp;&amp;(32===n.codePointAt(s)||9===n.codePointAt(s));)s-=1;s&lt;i?t.matches.pop():e.endpos=s}}return t.addMatch(e,e,&quot;escape&quot;),t.addMatch(e+1,i.endpos,&quot;hard_break&quot;),i.endpos+1}{const i=(0,r.find)(n,u,e+1,s);return null!==i?(t.addMatch(e,e,&quot;escape&quot;),t.addMatch(i.startpos,i.endpos,&quot;str&quot;),i.endpos+1):e+1&lt;=s&amp;&amp;32===n.codePointAt(e+1)?(t.addMatch(e,e,&quot;escape&quot;),t.addMatch(e+1,e+1,&quot;non_breaking_space&quot;),e+2):(t.addMatch(e,e,&quot;str&quot;),e+1)}},60:function(t,e,s){const n=t.subject,i=(0,r.find)(n,p,e,s);if(null===i)return null;const a=i.endpos,o=i.startpos,c=i.captures[0];return c.match(/[^:]@/)?(t.addMatch(o,o,&quot;+email&quot;),t.addMatch(o+1,a-1,&quot;str&quot;),t.addMatch(a,a,&quot;-email&quot;),a+1):c.match(/[a-zA-Z]:/)?(t.addMatch(o,o,&quot;+url&quot;),t.addMatch(o+1,a-1,&quot;str&quot;),t.addMatch(a,a,&quot;-url&quot;),a+1):null},126:M(&quot;~&quot;,&quot;subscript&quot;,&quot;str&quot;,I),94:M(&quot;^&quot;,&quot;superscript&quot;,&quot;str&quot;,I),95:M(&quot;_&quot;,&quot;emph&quot;,&quot;str&quot;,I),42:M(&quot;*&quot;,&quot;strong&quot;,&quot;str&quot;,I),43:M(&quot;+&quot;,&quot;insert&quot;,&quot;str&quot;,P),61:M(&quot;=&quot;,&quot;mark&quot;,&quot;str&quot;,P),39:M(&quot;&#39;&quot;,&quot;single_quoted&quot;,&quot;right_single_quote&quot;,(function(t,e){if(0===e)return!0;{const s=t.subject.codePointAt(e-1);return 32===s||9===s||13===s||10===s||34===s||39===s||45===s||40===s||91===s}})),34:M(&#39;&quot;&#39;,&quot;double_quoted&quot;,&quot;left_double_quote&quot;,I),[a]:function(t,e,s){return(0,r.find)(t.subject,f,e+1,s)?(t.addMatch(e,e,&quot;open_marker&quot;),e+1):t.allowAttributes?(t.attributeParser=new n.AttributeParser(t.subject),t.attributeStart=e,t.attributeSlices=[],e):(t.addMatch(e,e,&quot;str&quot;),e+1)},58:function(t,e,s){const n=(0,r.find)(t.subject,b,e,s);return n?(t.addMatch(n.startpos,n.endpos,&quot;symb&quot;),n.endpos+1):(t.addMatch(e,e,&quot;str&quot;),e+1)},46:function(t,e,s){return(0,r.find)(t.subject,g,e+1,s)?(t.addMatch(e,e+2,&quot;ellipses&quot;),e+3):null},91:function(t,e,s){const n=(0,r.find)(t.subject,A,e+1,s);return n?(t.addMatch(e,n.endpos,&quot;footnote_reference&quot;),n.endpos+1):(t.addOpener(&quot;[&quot;,e,e,&quot;str&quot;),e+1)},93:function(t,e,s){const n=t.openers[&quot;[&quot;],i=t.subject;if(n&amp;&amp;n.length&gt;0){const r=n[n.length-1];if(&quot;reference_link&quot;===r.annot)return t.strMatches((r.subendpos||r.endpos)+1,e-1),33===i.codePointAt(r.startpos-1)&amp;&amp;92!==i.codePointAt(r.startpos-2)?(t.addMatch(r.startpos-1,r.startpos-1,&quot;image_marker&quot;,r.matchIndex-1),t.addMatch(r.startpos,r.endpos,&quot;+imagetext&quot;,r.matchIndex),t.addMatch(r.substartpos||r.startpos,r.substartpos||r.startpos,&quot;-imagetext&quot;,r.subMatchIndex)):(t.addMatch(r.startpos,r.endpos,&quot;+linktext&quot;,r.matchIndex),t.addMatch(r.substartpos||r.startpos,r.substartpos||r.startpos,&quot;-linktext&quot;,r.subMatchIndex)),t.addMatch(r.subendpos||r.endpos,r.subendpos||r.endpos,&quot;+reference&quot;,r.subMatchIndex+1),t.addMatch(e,e,&quot;-reference&quot;),t.clearOpeners(r.startpos,e),e+1;if(e+1&lt;=s&amp;&amp;91===i.codePointAt(e+1))return r.annot=&quot;reference_link&quot;,t.addMatch(e,e,&quot;str&quot;),r.subMatchIndex=t.matches.length-1,t.addMatch(e+1,e+1,&quot;str&quot;),r.substartpos=e,r.subendpos=e+1,t.clearOpeners(r.startpos+1,e-1),e+2;if(e+1&lt;=s&amp;&amp;40===i.codePointAt(e+1))return t.openers[&quot;(&quot;]=[],r.annot=&quot;explicit_link&quot;,t.addMatch(e,e,&quot;str&quot;),r.subMatchIndex=t.matches.length-1,t.addMatch(e+1,e+1,&quot;str&quot;),r.substartpos=e,r.subendpos=e+1,t.destination=!0,t.clearOpeners(r.startpos+1,e-1),e+2;if(e+1&lt;=s&amp;&amp;i.codePointAt(e+1)===a)return t.addMatch(r.startpos,r.endpos,&quot;+span&quot;,r.matchIndex),t.addMatch(e,e,&quot;-span&quot;),t.clearOpeners(r.startpos,e),e+1}return null},40:function(t,e,s){return t.destination?(t.addOpener(&quot;(&quot;,e,e,&quot;str&quot;),e+1):null},41:function(t,e,s){if(!t.destination)return null;const n=t.openers[&quot;(&quot;];if(n&amp;&amp;n.length&gt;0)return n.pop(),t.addMatch(e,e,&quot;str&quot;),e+1;{const s=t.subject,n=t.openers[&quot;[&quot;],i=n[n.length-1];if(n&amp;&amp;n.length&gt;0&amp;&amp;&quot;explicit_link&quot;===i.annot)return t.strMatches((i.subendpos||i.endpos)+1,e-1),33===s.codePointAt(i.startpos-1)&amp;&amp;92!==s.codePointAt(i.startpos-2)?(t.addMatch(i.startpos-1,i.startpos-1,&quot;image_marker&quot;,i.matchIndex-1),t.addMatch(i.startpos,i.endpos,&quot;+imagetext&quot;,i.matchIndex),t.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,&quot;-imagetext&quot;,i.subMatchIndex)):(t.addMatch(i.startpos,i.endpos,&quot;+linktext&quot;,i.matchIndex),t.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,&quot;-linktext&quot;,i.subMatchIndex)),t.addMatch(i.subendpos||i.endpos,i.subendpos||i.endpos,&quot;+destination&quot;,i.subMatchIndex+1),t.addMatch(e,e,&quot;-destination&quot;),t.destination=!1,t.clearOpeners(i.startpos,e),e+1}return null},45:function(t,e,s){const n=t.subject;if(n.codePointAt(e-1)===a||n.codePointAt(e+1)===o){const n=M(&quot;-&quot;,&quot;delete&quot;,&quot;str&quot;,P)(t,e,s);if(n)return n}let i=e,r=0;for(;i&lt;=s&amp;&amp;45===n.codePointAt(i);)i++,r++;if(n.codePointAt(i)===o&amp;&amp;r--,0===r)return t.addMatch(e,e+1,&quot;str&quot;),e+2;const c=r%3==0,l=r%2==0;for(;r&gt;0;)c?(t.addMatch(e,e+2,&quot;em_dash&quot;),e+=3,r-=3):l?(t.addMatch(e,e+1,&quot;en_dash&quot;),e+=2,r-=2):r&gt;=3&amp;&amp;(r%2!=0||r&gt;4)?(t.addMatch(e,e+2,&quot;em_dash&quot;),e+=3,r-=3):r&gt;=2?(t.addMatch(e,e+1,&quot;en_dash&quot;),e+=2,r-=2):(t.addMatch(e,e,&quot;str&quot;),e+=1,r-=1);return e}};e.InlineParser=class{constructor(t,e={}){this.options=e,this.warn=e.warn||(()=&gt;{}),this.subject=t,this.matches=[],this.openers={},this.verbatim=0,this.verbatimType=&quot;&quot;,this.destination=!1,this.firstpos=-1,this.lastpos=0,this.allowAttributes=!0,this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,this.matchers=w}addMatch(t,e,s,n){const i={startpos:t,endpos:e,annot:s};void 0!==n?this.matches.splice(n,1,i):this.matches.push(i)}inVerbatim(){return this.verbatim&gt;0}singleChar(t){return this.addMatch(t,t,&quot;str&quot;),t+1}reparseAttributes(){const t=this.attributeSlices;if(null!==t){if(this.allowAttributes=!1,this.attributeParser=null,this.attributeStart=null,null!==t)for(const e of t)this.feed(e.startpos,e.endpos);this.allowAttributes=!0,this.attributeSlices=null}}getMatches(){const t=this.subject;this.attributeParser&amp;&amp;this.reparseAttributes();let e=this.matches.length-1;if(this.matches[e]&amp;&amp;&quot;soft_break&quot;===this.matches[e].annot){this.matches.pop();const e=this.matches[this.matches.length-1];if(e&amp;&amp;&quot;str&quot;===e.annot&amp;&amp;32===t.codePointAt(e.endpos)){for(;e.endpos&gt;=e.startpos&amp;&amp;32===t.codePointAt(e.endpos);)e.endpos=e.endpos-1;e.endpos&lt;e.startpos&amp;&amp;this.matches.pop()}}if(this.matches.length&gt;0&amp;&amp;this.verbatim&gt;0){const t=this.matches[this.matches.length-1];this.warn(new i.Warning(&quot;Unclosed verbatim&quot;,t.endpos)),this.matches.push({startpos:t.endpos,endpos:t.endpos,annot:&quot;-&quot;+this.verbatimType})}return this.matches}addOpener(t,e,s,n){this.openers[t]||(this.openers[t]=[]),this.openers[t].push({matchIndex:this.matches.length,startpos:e,endpos:s,annot:null,subMatchIndex:this.matches.length,substartpos:null,subendpos:null}),this.addMatch(e,s,n)}clearOpeners(t,e){for(const s in this.openers){const n=this.openers[s];let i=n.length-1;for(;n[i];){const s=n[i];if(s.startpos&gt;=t&amp;&amp;s.endpos&lt;=e)n.splice(i,1);else{if(!(s.substartpos&amp;&amp;s.substartpos&gt;=t&amp;&amp;s.subendpos&amp;&amp;s.subendpos&lt;=e))break;n[i].substartpos=null,n[i].subendpos=null,n[i].annot=null}i--}}}strMatches(t,e){let s=this.matches.length-1;for(;s&gt;0&amp;&amp;this.matches[s].startpos&gt;=t;)s--;for(this.matches[s].startpos&lt;t&amp;&amp;s++;this.matches[s]&amp;&amp;this.matches[s].endpos&lt;=e;){const t=this.matches[s];&quot;escape&quot;!==t.annot&amp;&amp;&quot;str&quot;!==t.annot&amp;&amp;(t.annot=&quot;str&quot;),s++}}feed(t,e){const s=this.subject;(-1===this.firstpos||t&lt;this.firstpos)&amp;&amp;(this.firstpos=t),(0===this.lastpos||e&gt;this.lastpos)&amp;&amp;(this.lastpos=e);let n=t;for(;n&lt;=e;)if(null!==this.attributeParser){const t=n,i=l(s,n,e);let r;r=null===i?e:i;const a=this.attributeParser.feed(t,r),o=a.position;if(&quot;done&quot;===a.status){const t=this.attributeStart;null!==t&amp;&amp;this.addMatch(t,t,&quot;+attributes&quot;);const e=this.attributeParser.matches;for(const t of e)this.addMatch(t.startpos,t.endpos,t.annot);this.addMatch(o,o,&quot;-attributes&quot;),this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,n=o+1}else&quot;fail&quot;===a.status?(this.reparseAttributes(),n=t):&quot;continue&quot;===a.status&amp;&amp;(null===this.attributeSlices&amp;&amp;(this.attributeSlices=[]),this.attributeSlices.push({startpos:t,endpos:o}),n=o+1)}else{const t=l(s,n,e);let i;if(i=null===t?e+1:t,i&gt;n&amp;&amp;(this.addMatch(n,i-1,&quot;str&quot;),n=i,n&gt;e))break;const a=s.codePointAt(n);if(void 0===a)throw new Error(&quot;Code point at &quot;+n+&quot; is undefined.&quot;);if(13===a||10===a)13===a&amp;&amp;10===s.codePointAt(n+1)&amp;&amp;n+1&lt;=e?(this.addMatch(n,n+1,&quot;soft_break&quot;),n+=2):(this.addMatch(n,n,&quot;soft_break&quot;),n+=1);else if(this.verbatim&gt;0)if(96===a){const t=(0,r.find)(s,_,n,e);if(t){const i=t.endpos;if(t.endpos-n+1===this.verbatim){const t=(0,r.find)(s,C,i+1,e);t&amp;&amp;&quot;verbatim&quot;===this.verbatimType?(this.addMatch(n,i,&quot;-&quot;+this.verbatimType),this.addMatch(t.startpos,t.endpos,&quot;raw_format&quot;),n=t.endpos+1):(this.addMatch(n,i,&quot;-&quot;+this.verbatimType),n=i+1),this.verbatim=0,this.verbatimType=&quot;verbatim&quot;}else this.addMatch(n,i,&quot;str&quot;),n=i+1}else this.addMatch(n,e,&quot;str&quot;),n=e+1}else this.addMatch(n,n,&quot;str&quot;),n+=1;else{const t=this.matchers[a];if(t){const s=t(this,n,e);n=null===s?this.singleChar(n):s}else n=this.singleChar(n)}}}}},380:(t,e)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.Warning=void 0,e.Warning=class{constructor(t,e){this.message=t,&quot;number&quot;==typeof e?this.offset=e:e&amp;&amp;&quot;line&quot;in e&amp;&amp;(this.sourceLoc=e,this.offset=e.offset)}render(){let t=this.message;return this.sourceLoc?t+=` at line ${this.sourceLoc.line}, col ${this.sourceLoc.col}`:this.offset&amp;&amp;(t+=` at offset ${this.offset}`),t}}},56:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.fromPandoc=e.toPandoc=void 0;const n=s(380),i={Decimal:{Period:&quot;1.&quot;,OneParen:&quot;1)&quot;,TwoParens:&quot;(1)&quot;},LowerAlpha:{Period:&quot;a.&quot;,OneParen:&quot;a)&quot;,TwoParens:&quot;(a)&quot;},UpperAlpha:{Period:&quot;A.&quot;,OneParen:&quot;A)&quot;,TwoParens:&quot;(A)&quot;},LowerRoman:{Period:&quot;i.&quot;,OneParen:&quot;i)&quot;,TwoParens:&quot;(i)&quot;},UpperRoman:{Period:&quot;I.&quot;,OneParen:&quot;I)&quot;,TwoParens:&quot;(I)&quot;}},r={};for(const t in i)for(const e in i[t])r[i[t][e]]=[t,e];const a=function(t){return&quot;Para&quot;===t.t&amp;&amp;(t.t=&quot;Plain&quot;),t},o=function(t){if(&quot;attributes&quot;in t&amp;&amp;t.attributes){const e=t.attributes.id||&quot;&quot;,s=t.attributes.class&amp;&amp;t.attributes.class.split(&quot; &quot;)||[],n=[];for(const s in t.attributes)s!==e&amp;&amp;&quot;class&quot;!==s&amp;&amp;n.push([s,t.attributes[s]]);return[e,s,n]}return[&quot;&quot;,[],[]]};class c{constructor(t={}){this.references={},this.footnotes={},this.options=t,this.smartPunctuationMap=this.options.smartPunctuationMap||{non_breaking_space:&quot; &quot;,ellipses:&quot;⋯&quot;,em_dash:&quot;-&quot;,en_dash:&quot;-&quot;,left_single_quote:&quot;‘&quot;,right_single_quote:&quot;’&quot;,left_double_quote:&quot;“&quot;,right_double_quote:&quot;”&quot;},this.warn||(this.warn=()=&gt;{})}toPandocChildren(t){if(&quot;children&quot;in t){const e=[];return t.children.forEach((t=&gt;{this.addToPandocElts(e,t)})),e}return[]}toPandocDefinitionListItem(t){const e=this;return function(t){if(!(&quot;children&quot;in t))return[];const[s,n]=t.children;return[e.toPandocChildren(s),[e.toPandocChildren(n)]]}}toPandocListItem(t){const e=this;return function(s){let n=e.toPandocChildren(s);return&quot;checkbox&quot;in s&amp;&amp;s.checkbox&amp;&amp;&quot;Para&quot;===n[0].t&amp;&amp;(&quot;checked&quot;===s.checkbox?n[0].c.unshift({t:&quot;Str&quot;,c:&quot;☒&quot;},{t:&quot;Space&quot;}):n[0].c.unshift({t:&quot;Str&quot;,c:&quot;☐&quot;},{t:&quot;Space&quot;})),&quot;tight&quot;in t&amp;&amp;t.tight&amp;&amp;(n=n.map(a)),n}}addToPandocElts(t,e){switch(e.tag){case&quot;section&quot;:case&quot;div&quot;:{const s=o(e);&quot;section&quot;===e.tag&amp;&amp;s[1].unshift(&quot;section&quot;),t.push({t:&quot;Div&quot;,c:[s,this.toPandocChildren(e)]});break}case&quot;block_quote&quot;:t.push({t:&quot;BlockQuote&quot;,c:this.toPandocChildren(e)});break;case&quot;definition_list&quot;:{const s=e.children.map(this.toPandocDefinitionListItem(e));t.push({t:&quot;DefinitionList&quot;,c:s});break}case&quot;task_list&quot;:case&quot;ordered_list&quot;:case&quot;bullet_list&quot;:{let s;if(e.style&amp;&amp;&quot;-&quot;===e.style||&quot;+&quot;===e.style||&quot;*&quot;===e.style||&quot;X&quot;===e.style)s=e.children.map(this.toPandocListItem(e)),t.push({t:&quot;BulletList&quot;,c:s});else{s=e.children.map(this.toPandocListItem(e));const[n,i]=r[e.style],a=e.start||1;t.push({t:&quot;OrderedList&quot;,c:[[a,{t:n},{t:i}],s]})}break}case&quot;task_list_item&quot;:case&quot;list_item&quot;:break;case&quot;para&quot;:t.push({t:&quot;Para&quot;,c:this.toPandocChildren(e)});break;case&quot;heading&quot;:t.push({t:&quot;Header&quot;,c:[e.level,o(e),this.toPandocChildren(e)]});break;case&quot;code_block&quot;:{const s=o(e);e.lang&amp;&amp;s[1].unshift(e.lang),t.push({t:&quot;CodeBlock&quot;,c:[s,e.text]});break}case&quot;raw_block&quot;:t.push({t:&quot;RawBlock&quot;,c:[e.format,e.text]});break;case&quot;thematic_break&quot;:t.push({t:&quot;HorizontalRule&quot;});break;case&quot;table&quot;:{const s=o(e),n=[&quot;&quot;,[],[]];let i=[],r=[],a=[];const c=[],l=[n,[]];let h=[],d=[];const u={left:&quot;AlignLeft&quot;,right:&quot;AlignRight&quot;,center:&quot;AlignCenter&quot;,default:&quot;AlignDefault&quot;},p=function(t){return[{t:u[t.align]||&quot;AlignDefault&quot;},{t:&quot;ColWidthDefault&quot;}]},f=this,b=function(t){if(&quot;children&quot;in t)return[o(t),{t:&quot;align&quot;in t&amp;&amp;u[t.align]||&quot;AlignDefault&quot;},1,1,[{t:&quot;Plain&quot;,c:f.toPandocChildren(t)}]]},g=function(t){if(&quot;children&quot;in t)return[o(t),t.children.map(b)]};for(let t=0;t&lt;e.children.length;t++){const s=e.children[t];if(!(&quot;children&quot;in s))break;0===r.length&amp;&amp;(r=s.children.map(p)),&quot;caption&quot;===s.tag?s.children.length&amp;&amp;(i=this.toPandocChildren(s)):s.head?0===d.length?h.push(g(s)):(c.push([n,0,h,d]),d=[],h=[g(s)]):(0===c.length&amp;&amp;0===d.length&amp;&amp;(a=h,h=[]),d.push(g(s)))}(h.length&gt;0||d.length&gt;0)&amp;&amp;c.push([n,0,h,d]),t.push({t:&quot;Table&quot;,c:[s,[null,[{t:&quot;Plain&quot;,c:i}]],r,[n,a],c,l]});break}case&quot;raw_inline&quot;:t.push({t:&quot;RawInline&quot;,c:[e.format,e.text]});break;case&quot;soft_break&quot;:t.push({t:&quot;SoftBreak&quot;});break;case&quot;hard_break&quot;:t.push({t:&quot;LineBreak&quot;});break;case&quot;str&quot;:e.text.split(/ +/).forEach(((e,s)=&gt;{s&gt;0&amp;&amp;t.push({t:&quot;Space&quot;}),e.length&gt;0&amp;&amp;t.push({t:&quot;Str&quot;,c:e})}));break;case&quot;verbatim&quot;:t.push({t:&quot;Code&quot;,c:[o(e),e.text]});break;case&quot;inline_math&quot;:t.push({t:&quot;Math&quot;,c:[{t:&quot;InlineMath&quot;},e.text]});break;case&quot;display_math&quot;:t.push({t:&quot;Math&quot;,c:[{t:&quot;DisplayMath&quot;},e.text]});break;case&quot;non_breaking_space&quot;:t.push({t:&quot;Str&quot;,c:&quot; &quot;});break;case&quot;smart_punctuation&quot;:t.push({t:&quot;Str&quot;,c:this.smartPunctuationMap[e.type]||e.text});break;case&quot;symb&quot;:t.push({t:&quot;Span&quot;,c:[[&quot;&quot;,[&quot;symbol&quot;],[[&quot;alias&quot;,e.alias]]],[{t:&quot;Str&quot;,c:&quot;:&quot;+e.alias+&quot;:&quot;}]]});break;case&quot;single_quoted&quot;:case&quot;double_quoted&quot;:{const s={t:&quot;single_quoted&quot;===e.tag?&quot;SingleQuote&quot;:&quot;DoubleQuote&quot;};t.push({t:&quot;Quoted&quot;,c:[s,this.toPandocChildren(e)]});break}case&quot;email&quot;:case&quot;url&quot;:{let s=e.text;&quot;email&quot;===e.tag&amp;&amp;(s=&quot;mailto:&quot;+s);const n=o(e);n[1].unshift(&quot;email&quot;===e.tag?&quot;email&quot;:&quot;uri&quot;),t.push({t:&quot;Link&quot;,c:[n,[{t:&quot;Str&quot;,c:e.text}],[s,&quot;&quot;]]});break}case&quot;image&quot;:case&quot;link&quot;:{let s=e.destination||&quot;&quot;;const i={};if(e.reference){const t=this.references[e.reference];if(t){if(s=t.destination||&quot;&quot;,t.attributes)for(const e in t.attributes)i[e]=t.attributes[e]}else this.warn(new n.Warning(&quot;Reference &quot;+e.reference+&quot; not found.&quot;))}if(e.attributes)for(const t in e.attributes)i[t]&amp;&amp;&quot;class&quot;===t?i[t]+=&quot; &quot;+e.attributes[t]:i[t]||(i[t]=e.attributes[t]);const r=o({tag:&quot;link&quot;,attributes:i,children:[]}),a=s||&quot;&quot;,c=e.attributes&amp;&amp;e.attributes.title||&quot;&quot;;c&amp;&amp;(r[2]=r[2].filter((([t,e])=&gt;&quot;title&quot;!==t))),t.push({t:&quot;link&quot;===e.tag?&quot;Link&quot;:&quot;Image&quot;,c:[r,this.toPandocChildren(e),[a,c]]});break}case&quot;emph&quot;:t.push({t:&quot;Emph&quot;,c:this.toPandocChildren(e)});break;case&quot;strong&quot;:t.push({t:&quot;Strong&quot;,c:this.toPandocChildren(e)});break;case&quot;superscript&quot;:t.push({t:&quot;Superscript&quot;,c:this.toPandocChildren(e)});break;case&quot;subscript&quot;:t.push({t:&quot;Subscript&quot;,c:this.toPandocChildren(e)});break;case&quot;span&quot;:t.push({t:&quot;Span&quot;,c:[o(e),this.toPandocChildren(e)]});break;case&quot;mark&quot;:t.push({t:&quot;Span&quot;,c:[[&quot;&quot;,[&quot;mark&quot;],[]],this.toPandocChildren(e)]});break;case&quot;insert&quot;:t.push({t:&quot;Underline&quot;,c:this.toPandocChildren(e)});break;case&quot;delete&quot;:t.push({t:&quot;Strikeout&quot;,c:this.toPandocChildren(e)});break;case&quot;footnote_reference&quot;:{const s=this.footnotes[e.text];s?t.push({t:&quot;Note&quot;,c:this.toPandocChildren(s)}):t.push({t:&quot;Superscript&quot;,c:[{t:&quot;Str&quot;,c:e.text}]});break}default:this.warn(new n.Warning(&quot;Skipping unhandled node &quot;+e.tag))}}toPandoc(t){return this.references=t.references,this.footnotes=t.footnotes,{&quot;pandoc-api-version&quot;:[1,23],meta:{},blocks:this.toPandocChildren(t)}}}const l=function(t){const e={};t[0]&amp;&amp;(e.id=t[0]),t[1].length&gt;0&amp;&amp;(e.class=t[1].join(&quot; &quot;));for(let s=0;s&lt;t[2].length;s++)e[t[2][s][0].toString()]=t[2][s][1];return 0===Object.keys(e).length?null:e},h=function(t){return&quot;Plain&quot;===t.t||&quot;Para&quot;===t.t},d=function(t){if(!t[0])return null;const e=t[0];return h(e)&amp;&amp;e.c.length&gt;=2&amp;&amp;&quot;Str&quot;===e.c[0].t&amp;&amp;&quot;Space&quot;===e.c[1].t?&quot;☒&quot;===e.c[0].c?(e.c.shift(),e.c.shift(),&quot;checked&quot;):&quot;☐&quot;===e.c[0].c?(e.c.shift(),e.c.shift(),&quot;unchecked&quot;):null:null};class u{constructor(t={}){this.footnotes={},this.footnoteIndex=0,this.options=t,this.warn=t.warn||(()=&gt;{})}fromPandocInlines(t){let e=[];const s=[];for(let n=0;n&lt;t.length;n++){const i=t[n];if(&quot;Str&quot;===i.t)e.push(i.c);else if(&quot;Space&quot;===i.t)e.push(&quot; &quot;);else switch(e.length&gt;0&amp;&amp;(s.push({tag:&quot;str&quot;,text:e.join(&quot;&quot;)}),e=[]),i.t){case&quot;SoftBreak&quot;:s.push({tag:&quot;soft_break&quot;});break;case&quot;LineBreak&quot;:s.push({tag:&quot;hard_break&quot;});break;case&quot;Emph&quot;:s.push({tag:&quot;emph&quot;,children:this.fromPandocInlines(i.c)});break;case&quot;Strong&quot;:s.push({tag:&quot;strong&quot;,children:this.fromPandocInlines(i.c)});break;case&quot;Superscript&quot;:s.push({tag:&quot;superscript&quot;,children:this.fromPandocInlines(i.c)});break;case&quot;Subscript&quot;:s.push({tag:&quot;subscript&quot;,children:this.fromPandocInlines(i.c)});break;case&quot;Strikeout&quot;:s.push({tag:&quot;delete&quot;,children:this.fromPandocInlines(i.c)});break;case&quot;Span&quot;:{const t={tag:&quot;span&quot;,children:this.fromPandocInlines(i.c[1])},e=l(i.c[0]);e&amp;&amp;(t.attributes=e),s.push(t);break}case&quot;Underline&quot;:s.push({tag:&quot;span&quot;,attributes:{class:&quot;underline&quot;},children:this.fromPandocInlines(i.c)});break;case&quot;SmallCaps&quot;:s.push({tag:&quot;span&quot;,attributes:{class:&quot;smallcaps&quot;},children:this.fromPandocInlines(i.c)});break;case&quot;Math&quot;:s.push({tag:&quot;DisplayMath&quot;===i.c[0].t?&quot;display_math&quot;:&quot;inline_math&quot;,text:i.c[1]});break;case&quot;Quoted&quot;:&quot;SingleQuote&quot;===i.c[0].t?s.push({tag:&quot;single_quoted&quot;,children:this.fromPandocInlines(i.c[1])}):s.push({tag:&quot;double_quoted&quot;,children:this.fromPandocInlines(i.c[1])});break;case&quot;RawInline&quot;:s.push({tag:&quot;raw_inline&quot;,format:i.c[0],text:i.c[1]});break;case&quot;Code&quot;:{const t=l(i.c[0]),e={tag:&quot;verbatim&quot;,text:i.c[1]};t&amp;&amp;(e.attributes=t),s.push(e);break}case&quot;Image&quot;:case&quot;Link&quot;:{let t=l(i.c[0]);i.c[2][1]&amp;&amp;(t=t||{},t.title=i.c[2][1]);const e=i.c[2][0],n=this.fromPandocInlines(i.c[1]);if(&quot;Image&quot;===i.t){const i={tag:&quot;image&quot;,destination:e,children:n};t&amp;&amp;(i.attributes=t),s.push(i)}else{const i={tag:&quot;link&quot;,destination:e,children:n};t&amp;&amp;(i.attributes=t),s.push(i)}break}case&quot;Cite&quot;:s.push({tag:&quot;span&quot;,attributes:{class:&quot;cite&quot;},children:this.fromPandocInlines(i.c[1])});break;case&quot;Note&quot;:{this.footnoteIndex++;const t=this.footnoteIndex.toString(),e=i.c.map((t=&gt;this.fromPandocBlock(t)));this.footnotes[this.footnoteIndex.toString()]={tag:&quot;footnote&quot;,label:t,children:e},s.push({tag:&quot;footnote_reference&quot;,text:t});break}}}return e.length&gt;0&amp;&amp;s.push({tag:&quot;str&quot;,text:e.join(&quot;&quot;)}),s}fromPandocBlock(t){switch(t.t){case&quot;Plain&quot;:case&quot;Para&quot;:return{tag:&quot;para&quot;,children:this.fromPandocInlines(t.c)};case&quot;BlockQuote&quot;:return{tag:&quot;block_quote&quot;,children:t.c.map((t=&gt;this.fromPandocBlock(t)))};case&quot;Div&quot;:{let e=l(t.c[0]);const s=/\bsection\b/.test(e&amp;&amp;e.class||&quot;&quot;)?&quot;section&quot;:&quot;div&quot;,n=t.c[1].map((t=&gt;this.fromPandocBlock(t)));if(&quot;section&quot;===s)return e=e||{},e.class=e.class.replace(/section */,&quot;&quot;),e.class||delete e.class,{tag:&quot;section&quot;,attributes:e,children:n};{const t={tag:&quot;div&quot;,children:n};return e&amp;&amp;(t.attributes=e),t}}case&quot;Header&quot;:{const e=l(t.c[1]),s={tag:&quot;heading&quot;,level:t.c[0],children:this.fromPandocInlines(t.c[2])};return e&amp;&amp;(s.attributes=e),s}case&quot;HorizontalRule&quot;:return{tag:&quot;thematic_break&quot;};case&quot;RawBlock&quot;:return{tag:&quot;raw_block&quot;,format:t.c[0],text:t.c[1]};case&quot;CodeBlock&quot;:{const e=l(t.c[0]);let s;if(e&amp;&amp;e.class){const t=e.class.split(/  */);s=t[0],t.shift(),t.length&gt;0?e.class=t.join(&quot; &quot;):delete e.class}const n={tag:&quot;code_block&quot;,lang:s,text:t.c[1]};return e&amp;&amp;(n.attributes=e),s||delete n.lang,n}case&quot;DefinitionList&quot;:{const e=[];for(let s=0;s&lt;t.c.length;s++){const n=t.c[s][0],i=t.c[s][1],r=this.fromPandocInlines(n),a=[];for(let t=0;t&lt;i.length;t++)i[t].map((t=&gt;{a.push(this.fromPandocBlock(t))}));e.push({tag:&quot;definition_list_item&quot;,children:[{tag:&quot;term&quot;,children:r},{tag:&quot;definition&quot;,children:a}]})}return{tag:&quot;definition_list&quot;,children:e}}case&quot;OrderedList&quot;:case&quot;BulletList&quot;:{const e=[],s=[];let n,r=!1;n=&quot;BulletList&quot;===t.t?t.c:t.c[1];for(let t=0;t&lt;n.length;t++){const i=d(n[t]),a=n[t].map((t=&gt;(&quot;Plain&quot;===t.t?r=!0:&quot;Para&quot;===t.t&amp;&amp;(r=!1),this.fromPandocBlock(t))));null!==i?s.push({tag:&quot;task_list_item&quot;,checkbox:i,children:a}):e.push({tag:&quot;list_item&quot;,children:a})}if(&quot;BulletList&quot;===t.t)return s.length&gt;0?{tag:&quot;task_list&quot;,tight:r,children:s}:{tag:&quot;bullet_list&quot;,style:&quot;-&quot;,tight:r,children:e};if(&quot;OrderedList&quot;===t.t){const s=t.c[0][0];let n=t.c[0][1].t;&quot;DefaultStyle&quot;===n&amp;&amp;(n=&quot;Decimal&quot;);let a=t.c[0][2].t;return&quot;DefaultDelim&quot;===a&amp;&amp;(a=&quot;Period&quot;),{tag:&quot;ordered_list&quot;,style:i[n][a],start:s,tight:r,children:e}}}case&quot;Table&quot;:{const e=l(t.c[0]),s=t.c[1][1],i={tag:&quot;caption&quot;,children:[]};s.length&gt;1||1===s.length&amp;&amp;!h(s[0])?this.warn(new n.Warning(&quot;Skipping block-level content in table caption.&quot;)):s[0]&amp;&amp;&quot;c&quot;in s[0]&amp;&amp;(i.children=this.fromPandocInlines(s[0].c));const r=t.c[2],a=[];for(const t in r)a.push(r[t][0].t.slice(5).toLowerCase());const o=[],c=t.c[3][1];for(const t in c)o.push(this.fromPandocRow(c[t],!0,0,a));const d=t.c[4];for(const t in d){const e=d[t][1],s=d[t][2];for(const t in s)o.push(this.fromPandocRow(s[t],!0,e,a));const n=d[t][3];for(const t in n)o.push(this.fromPandocRow(n[t],!1,e,a))}const u=t.c[5][1];for(const t in u)o.push(this.fromPandocRow(u[t],!1,0,a));const p={tag:&quot;table&quot;,children:[i,...o]};return e&amp;&amp;(p.attributes=e),p}case&quot;Figure&quot;:{let e=l(t.c[0]);/\bsection\b/.test(e&amp;&amp;e.class||&quot;&quot;);let s=t.c[2].map((t=&gt;this.fromPandocBlock(t)));const n=t.c[1][1];if(n.length&gt;0){const t=n.map((t=&gt;this.fromPandocBlock(t)));s.push(...t)}const i={tag:&quot;div&quot;,children:s};return e&amp;&amp;(i.attributes=e),i}case&quot;LineBlock&quot;:{const e=[];for(let s=0;s&lt;t.c.length;s++)s&gt;0&amp;&amp;e.push({tag:&quot;hard_break&quot;}),e.push(...this.fromPandocInlines(t.c[s]));return{tag:&quot;para&quot;,children:e}}case&quot;Null&quot;:return{tag:&quot;raw_block&quot;,format:&quot;none&quot;,text:&quot;&quot;}}return{tag:&quot;raw_block&quot;,format:&quot;error&quot;,text:&quot;Could not convert &quot;+t.t}}fromPandocRow(t,e,s,n){const i=l(t[0]),r=t[1],a=[];for(let t=0;t&lt;r.length;t++)a.push(this.fromPandocCell(r[t],e||t&lt;s,n[t]));const o={tag:&quot;row&quot;,head:e,children:a};return i&amp;&amp;(o.attributes=i),o}fromPandocCell(t,e,s){let i=[];const r=l(t[0]);let a=t[1].t.slice(5).toLowerCase();&quot;default&quot;===a&amp;&amp;(a=s);const o=t[4];o.length&gt;1||1===o.length&amp;&amp;!h(o[0])?(this.warn(new n.Warning(&quot;Skipping table cell with block-level content.&quot;)),i=[{tag:&quot;str&quot;,text:&quot;((content omitted))&quot;}]):o[0]&amp;&amp;(i=this.fromPandocInlines(o[0].c));const c={tag:&quot;cell&quot;,head:e,align:a,children:i};return r&amp;&amp;(c.attributes=r),c}fromPandoc(t){if(&quot;object&quot;!=typeof t)throw Error(&quot;Pandoc document must be an object&quot;);if(!t[&quot;pandoc-api-version&quot;])throw Error(&quot;Pandoc document lacks pandoc-api-version&quot;);if(!t.blocks)throw Error(&quot;Pandoc document lacks blocks&quot;);if(!t.meta)throw Error(&quot;Pandoc document lacks meta&quot;);return{tag:&quot;doc&quot;,children:t.blocks.map((t=&gt;this.fromPandocBlock(t))),footnotes:this.footnotes,references:{}}}}e.toPandoc=function(t,e){return new c(e).toPandoc(t)},e.fromPandoc=function(t,e){return new u(e).fromPandoc(t)}},306:(t,e,s)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.isInline=e.isCaption=e.isRow=e.isBlock=e.getStringContent=e.renderAST=e.parse=void 0;const n=s(155),i=s(380),r=s(60);Object.defineProperty(e,&quot;isRow&quot;,{enumerable:!0,get:function(){return r.isRow}}),Object.defineProperty(e,&quot;isBlock&quot;,{enumerable:!0,get:function(){return r.isBlock}}),Object.defineProperty(e,&quot;isCaption&quot;,{enumerable:!0,get:function(){return r.isCaption}}),Object.defineProperty(e,&quot;isInline&quot;,{enumerable:!0,get:function(){return r.isInline}});const a=function(t){const e=[];return o(t,e),e.join(&quot;&quot;)};e.getStringContent=a;const o=function(t,e){if(&quot;text&quot;in t)e.push(t.text);else if(!(&quot;tag&quot;in t)||&quot;soft_break&quot;!==t.tag&amp;&amp;&quot;hard_break&quot;!==t.tag){if(&quot;children&quot;in t)for(const s of t.children)o(s,e)}else e.push(&quot;\n&quot;)},c=function(t){return t.replace(/^ `/,&quot;`&quot;).replace(/` $/,&quot;`&quot;)},l={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3,I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};var h;!function(t){t[t.Normal=0]=&quot;Normal&quot;,t[t.Verbatim=1]=&quot;Verbatim&quot;,t[t.Literal=2]=&quot;Literal&quot;}(h||(h={})),e.parse=function(t,e={}){const s=[-1];if(e.sourcePositions)for(let e=0;e&lt;t.length;e++)&quot;\n&quot;===t[e]&amp;&amp;s.push(e);const r=function(t){let e=0,n=s.length-1,i=0,r=0;for(;!i;){const a=e+~~((n-e)/2);s[a]&gt;t?n=a:s[a]&lt;=t&amp;&amp;(a===n||s[a+1]&gt;t?(i=a+1,r=t-s[a]):e=e===a&amp;&amp;e&lt;n?a+1:a)}return{line:i,col:r,offset:t}};let o=h.Normal,d=&quot;&quot;;const u={},p={},f={},b={};let g=0;const m=(0,n.parseEvents)(t,e),_=e.warn||(()=&gt;{}),k=function(t){if(Object.keys(b).length&gt;0){t.attributes=t.attributes||{};for(const e in b)t.attributes[e]=b[e],delete b[e]}},N=function(t){const e={children:[],data:{},pos:t,attributes:void 0};k(e),w.push(e)},x=function(t){const e=w.pop();if(!e)throw new Error(&quot;Container stack is empty (popContainer)&quot;);return t&amp;&amp;e.pos&amp;&amp;(e.pos.end=t.end),e},C=function(){if(w.length&gt;0)return w[w.length-1];throw new Error(&quot;Container stack is empty (topContainer)&quot;)},A=function(){const t=C();return t.children.length&gt;0?t.children[t.children.length-1]:t},P=function(t){w.length&gt;0&amp;&amp;w[w.length-1].children.push(t)},I={str:(e,s,n,i)=&gt;{const r=t.substring(s,n+1);o===h.Normal?P({tag:&quot;str&quot;,text:r,pos:i}):d+=r},soft_break:(t,e,s,n)=&gt;{o===h.Normal?P({tag:&quot;soft_break&quot;,pos:n}):d+=&quot;\n&quot;},escape:(t,e,s,n)=&gt;{o===h.Verbatim&amp;&amp;(d+=&quot;\\&quot;)},hard_break:(t,e,s,n)=&gt;{o===h.Normal?P({tag:&quot;hard_break&quot;,pos:n}):d+=&quot;\n&quot;},non_breaking_space:(t,e,s,n)=&gt;{o===h.Verbatim?d+=&quot;\\ &quot;:P({tag:&quot;non_breaking_space&quot;,pos:n})},symb:(e,s,n,i)=&gt;{if(o===h.Normal){const e=t.substring(s+1,n);P({tag:&quot;symb&quot;,alias:e,pos:i})}else{const e=t.substring(s,n+1);d+=e}},footnote_reference:(e,s,n,i)=&gt;{const r=t.substring(s+2,n);P({tag:&quot;footnote_reference&quot;,text:r,pos:i})},&quot;+reference_definition&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-reference_definition&quot;:(t,e,s,n)=&gt;{const i=x(n),r={tag:&quot;reference&quot;,label:i.data.key,destination:i.data.value||&quot;&quot;,attributes:i.attributes};i.data.key&amp;&amp;(u[i.data.key]=r)},reference_key:(e,s,n,i)=&gt;{C().data.key=t.substring(s+1,n),C().data.value=&quot;&quot;},reference_value:(e,s,n,i)=&gt;{C().data.value=C().data.value+t.substring(s,n+1)},&quot;+emph&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-emph&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;emph&quot;,children:i.children,pos:i.pos})},&quot;+strong&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-strong&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;strong&quot;,children:i.children,pos:i.pos})},&quot;+span&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-span&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;span&quot;,children:i.children,pos:i.pos})},&quot;+mark&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-mark&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;mark&quot;,children:i.children,pos:i.pos})},&quot;+superscript&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-superscript&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;superscript&quot;,children:i.children,pos:i.pos})},&quot;+subscript&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-subscript&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;subscript&quot;,children:i.children,pos:i.pos})},&quot;+delete&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-delete&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;delete&quot;,children:i.children,pos:i.pos})},&quot;+insert&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-insert&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;insert&quot;,children:i.children,pos:i.pos})},&quot;+double_quoted&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-double_quoted&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;double_quoted&quot;,children:i.children,pos:i.pos})},&quot;+single_quoted&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-single_quoted&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;single_quoted&quot;,children:i.children,pos:i.pos})},&quot;+attributes&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-attributes&quot;:(t,s,n,a)=&gt;{const o=x(a);if(o.attributes&amp;&amp;w.length&gt;0){o.attributes.id&amp;&amp;(f[o.attributes.id]=!0);let t=A();if(t===C())return;let n=!1;if(&quot;tag&quot;in t&amp;&amp;&quot;str&quot;===t.tag){const e=t.text.match(/[^\s]+$/);if(e&amp;&amp;e.index&amp;&amp;e.index&gt;0){let s;if(t.pos){const n=t.pos.end;t.pos.end={line:n.line,col:n.col-e[0].length,offset:n.offset-e[0].length},s={start:{line:n.line,col:n.col-e[0].length+1,offset:n.offset-e[0].length+1},end:n}}t.text=t.text.substring(0,e.index),P({tag:&quot;str&quot;,text:e[0],pos:s})}else e||(n=!0)}if(t=A(),n)return void _(new i.Warning(&quot;Ignoring unattached attribute&quot;,e.sourcePositions?r(s):s));t.attributes||(t.attributes={});for(const e in o.attributes)&quot;class&quot;===e&amp;&amp;t.attributes[e]?t.attributes[e]=t.attributes[e]+&quot; &quot;+o.attributes[e]:t.attributes[e]=o.attributes[e]}},&quot;+block_attributes&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-block_attributes&quot;:(t,e,s,n)=&gt;{const i=x(n);if(i.attributes&amp;&amp;w.length&gt;0){i.attributes.id&amp;&amp;(f[i.attributes.id]=!0);for(const t in i.attributes)&quot;class&quot;===t&amp;&amp;b[t]?b[t]=b[t]+&quot; &quot;+i.attributes[t]:b[t]=i.attributes[t]}},class:(e,s,n,i)=&gt;{const r=C(),a=t.substring(s,n+1);r.attributes||(r.attributes={}),r.attributes.class?r.attributes.class=r.attributes.class+&quot; &quot;+a:r.attributes.class=a},id:(e,s,n,i)=&gt;{const r=C(),a=t.substring(s,n+1);r.attributes?r.attributes.id=a:r.attributes={id:a}},key:(e,s,n,i)=&gt;{const r=C(),a=t.substring(s,n+1);r.data.key=a,r.attributes||(r.attributes={}),r.attributes[r.data.key]=&quot;&quot;},value:(e,s,n,i)=&gt;{const r=C(),a=t.substring(s,n+1).replace(/[ \r\n]+/g,&quot; &quot;).replace(/\\([.,\\/#!$%^&amp;*;:{}=\-_`~+[\]()&#39;&quot;?|])/g,&quot;$1&quot;);if(r.attributes||(r.attributes={}),!r.data.key)throw new Error(&quot;Encountered value without key&quot;);r.attributes[r.data.key]=r.attributes[r.data.key]+a},&quot;+linktext&quot;:(t,e,s,n)=&gt;{N(n),C().data.isimage=!1},&quot;-linktext&quot;:(t,e,s,n)=&gt;{},&quot;+imagetext&quot;:(t,e,s,n)=&gt;{N(n),C().data.isimage=!0},&quot;-imagetext&quot;:(t,e,s,n)=&gt;{},&quot;+destination&quot;:(t,e,s,n)=&gt;{o=h.Literal},&quot;-destination&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:i.data.isimage?&quot;image&quot;:&quot;link&quot;,destination:d.replace(/[\r\n]/g,&quot;&quot;),children:i.children,pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;+reference&quot;:(t,e,s,n)=&gt;{o=h.Literal},&quot;-reference&quot;:(t,e,s,n)=&gt;{const i=x(n);let r=d.replace(/\r?\n/g,&quot; &quot;);0===r.length&amp;&amp;(r=a(i)),P({tag:i.data.isimage?&quot;image&quot;:&quot;link&quot;,reference:r,children:i.children,pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;+verbatim&quot;:(t,e,s,n)=&gt;{o=h.Verbatim,N(n)},&quot;-verbatim&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;verbatim&quot;,text:c(d),pos:i.pos}),o=h.Normal,d=&quot;&quot;},raw_format:(e,s,n,i)=&gt;{const r=t.substring(s,n+1).replace(/^\{?=/,&quot;&quot;).replace(/\}$/,&quot;&quot;),a=C();if(o===h.Verbatim)a.data.format=r;else{const t=a.children[a.children.length-1];if(!t||!(&quot;tag&quot;in t)||&quot;verbatim&quot;!==t.tag)throw new Error(&quot;raw_format is not after verbatim or code_block.&quot;);t.tag=&quot;raw_inline&quot;,t.format=r}},&quot;+display_math&quot;:(t,e,s,n)=&gt;{o=h.Verbatim,N(n)},&quot;+inline_math&quot;:(t,e,s,n)=&gt;{o=h.Verbatim,N(n)},&quot;-display_math&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;display_math&quot;,text:c(d),pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;-inline_math&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;inline_math&quot;,text:c(d),pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;+url&quot;:(t,e,s,n)=&gt;{o=h.Literal,N(n)},&quot;-url&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;url&quot;,text:d.replace(/[\r\n]/g,&quot;&quot;),pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;+email&quot;:(t,e,s,n)=&gt;{o=h.Literal,N(n)},&quot;-email&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;email&quot;,text:d.replace(/[\r\n]/g,&quot;&quot;),pos:i.pos}),o=h.Normal,d=&quot;&quot;},&quot;+para&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-para&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;para&quot;,children:i.children,attributes:i.attributes,pos:i.pos})},&quot;+heading&quot;:(t,e,s,n)=&gt;{N(n),C().data.level=1+s-e},&quot;-heading&quot;:(t,e,s,n)=&gt;{const i=x(n);i.attributes||(i.attributes={});const r=a(i).trim();i.attributes.id||(i.attributes.id=function(t){const e=t.trim().replace(/[\W\s.]+/g,&quot;-&quot;).replace(/-$/,&quot;&quot;).replace(/^-/,&quot;&quot;);let s=0,n=e;for(;!n||f[n];)s+=1,n=(e||&quot;s&quot;)+&quot;-&quot;+s;return n}(r),f[i.attributes.id]=!0),u[r]||(u[r]={tag:&quot;reference&quot;,label:r,destination:&quot;#&quot;+i.attributes.id});let o=C();if(void 0!==o.data.headinglevel){for(;o&amp;&amp;void 0!==o.data.headinglevel&amp;&amp;o.data.headinglevel&gt;=i.data.level;)o=x(n),P({tag:&quot;section&quot;,children:o.children,attributes:o.attributes,pos:o.pos}),o=C();N(n),C().data.headinglevel=i.data.level,i.attributes&amp;&amp;i.attributes.id&amp;&amp;(C().attributes=i.attributes,delete i.attributes)}P({tag:&quot;heading&quot;,level:i.data.level,children:i.children,attributes:i.attributes,pos:i.pos})},&quot;+list&quot;:(t,e,s,n)=&gt;{N(n),C().data.styles=t,C().data.blanklines=!1,C().data.tight=!0,g++},&quot;-list&quot;:(t,e,s,n)=&gt;{const i=x(n),r=i.data.styles[0];if(!r)throw new Error(&quot;No style defined for list&quot;);const a=function(t,e){const s=e.replace(/[().]/g,&quot;&quot;),n=t.replace(/[().]/g,&quot;&quot;);switch(s){case&quot;1&quot;:return parseInt(n,10);case&quot;A&quot;:return(n.codePointAt(0)||65)-65+1;case&quot;a&quot;:return(n.codePointAt(0)||97)-97+1;case&quot;I&quot;:case&quot;i&quot;:return function(t){let e=0,s=0,n=t.length-1;for(;n&gt;=0;){const i=t.charAt(n),r=l[i];if(!r)throw new Error(&quot;Encountered bad character in roman numeral &quot;+t);r&lt;s?e-=r:e+=r,s=r,n-=1}return e}(n)}}(i.data.firstMarker,r);P(&quot;:&quot;===r?{tag:&quot;definition_list&quot;,children:i.children,attributes:i.attributes,pos:i.pos}:&quot;X&quot;===r?{tag:&quot;task_list&quot;,tight:i.data.tight,children:i.children,attributes:i.attributes,pos:i.pos}:&quot;+&quot;===r||&quot;*&quot;===r||&quot;-&quot;===r?{tag:&quot;bullet_list&quot;,tight:i.data.tight,style:r,children:i.children,attributes:i.attributes,pos:i.pos}:{tag:&quot;ordered_list&quot;,style:r,children:i.children,start:a,tight:i.data.tight,attributes:i.attributes,pos:i.pos}),g--},&quot;+list_item&quot;:(e,s,n,i)=&gt;{e.length&lt;C().data.styles.length&amp;&amp;(C().data.styles=e),C().data.firstMarker||(C().data.firstMarker=t.substring(s,n+1)),N(i),1===e.length&amp;&amp;&quot;:&quot;===e[0]&amp;&amp;(C().data.definitionList=!0)},&quot;-list_item&quot;:(t,e,s,n)=&gt;{const i=x(n);if(i.data.definitionList)if(i.children[0]&amp;&amp;&quot;para&quot;===i.children[0].tag){const t={tag:&quot;term&quot;,children:i.children[0].children};i.children.shift();const e={tag:&quot;definition&quot;,children:i.children};P({tag:&quot;definition_list_item&quot;,children:[t,e],attributes:i.attributes,pos:i.pos})}else{const t={tag:&quot;term&quot;,children:[]},e={tag:&quot;definition&quot;,children:i.children};P({tag:&quot;definition_list_item&quot;,children:[t,e],attributes:i.attributes,pos:i.pos})}else i.data.checkbox?P({tag:&quot;task_list_item&quot;,children:i.children,attributes:i.attributes,checkbox:i.data.checkbox,pos:i.pos}):P({tag:&quot;list_item&quot;,children:i.children,attributes:i.attributes,pos:i.pos})},checkbox_checked:(t,e,s,n)=&gt;{C().data.checkbox=&quot;checked&quot;},checkbox_unchecked:(t,e,s,n)=&gt;{C().data.checkbox=&quot;unchecked&quot;},&quot;+block_quote&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-block_quote&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;block_quote&quot;,children:i.children,attributes:i.attributes,pos:i.pos})},&quot;+table&quot;:(t,e,s,n)=&gt;{N(n),C().data.aligns=[]},&quot;-table&quot;:(t,e,s,n)=&gt;{var i;const r=x(n),a=r.children;let o={tag:&quot;caption&quot;,children:[]};&quot;caption&quot;===(null===(i=a[0])||void 0===i?void 0:i.tag)&amp;&amp;(o=a.shift()),P({tag:&quot;table&quot;,children:[o,...a],attributes:r.attributes,pos:r.pos})},&quot;+row&quot;:(t,e,s,n)=&gt;{N(n),C().data.aligns=[]},&quot;-row&quot;:(t,e,s,n)=&gt;{const i=x(n);if(0===i.children.length){C().data.aligns=i.data.aligns;const t=A();if(t&amp;&amp;&quot;tag&quot;in t&amp;&amp;&quot;row&quot;===t.tag){t.head=!0;for(let e=0;e&lt;t.children.length;e++)t.children[e].head=!0,t.children[e].align=i.data.aligns[e]||&quot;default&quot;}}else{i.data.aligns=[];for(let t=0;t&lt;i.children.length;t++)i.children[t].align=C().data.aligns[t]||&quot;default&quot;;P({tag:&quot;row&quot;,children:i.children,head:!1,attributes:i.attributes,pos:i.pos})}},separator_default:(t,e,s,n)=&gt;{C().data.aligns.push(&quot;default&quot;)},separator_left:(t,e,s,n)=&gt;{C().data.aligns.push(&quot;left&quot;)},separator_right:(t,e,s,n)=&gt;{C().data.aligns.push(&quot;right&quot;)},separator_center:(t,e,s,n)=&gt;{C().data.aligns.push(&quot;center&quot;)},&quot;+cell&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-cell&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;cell&quot;,children:i.children,head:!1,align:&quot;default&quot;,attributes:i.attributes,pos:i.pos})},&quot;+caption&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-caption&quot;:(t,e,s,n)=&gt;{const i=x(n),r=A();!r||&quot;tag&quot;in r&amp;&amp;&quot;table&quot;!==r.tag||r.children.unshift({tag:&quot;caption&quot;,children:i.children,attributes:i.attributes,pos:i.pos})},&quot;+footnote&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-footnote&quot;:(t,s,n,a)=&gt;{const o=x(a);o.data.label?p[o.data.label]={tag:&quot;footnote&quot;,label:o.data.label||&quot;&quot;,children:o.children,attributes:o.attributes,pos:o.pos}:_(new i.Warning(&quot;Ignoring footnote without a label.&quot;,e.sourcePositions?r(n):n))},note_label:(e,s,n,i)=&gt;{C().data.label=t.substring(s,n+1)},&quot;+code_block&quot;:(t,e,s,n)=&gt;{N(n),o=h.Verbatim},&quot;-code_block&quot;:(t,e,s,n)=&gt;{const i=x(n);i.data.format?P({tag:&quot;raw_block&quot;,format:i.data.format,text:d,attributes:i.attributes,pos:i.pos}):P({tag:&quot;code_block&quot;,text:d,lang:i.data.lang,attributes:i.attributes,pos:i.pos}),o=h.Normal,d=&quot;&quot;},code_language:(e,s,n,i)=&gt;{C().data.lang=t.substring(s,n+1)},&quot;+div&quot;:(t,e,s,n)=&gt;{N(n)},&quot;-div&quot;:(t,e,s,n)=&gt;{const i=x(n);P({tag:&quot;div&quot;,children:i.children,attributes:i.attributes,pos:i.pos})},thematic_break:(t,e,s,n)=&gt;{const i={tag:&quot;thematic_break&quot;,pos:n};k(i),P(i)},left_single_quote:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;left_single_quote&quot;,text:&quot;&#39;&quot;,pos:n})},right_single_quote:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;right_single_quote&quot;,text:&quot;&#39;&quot;,pos:n})},left_double_quote:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;left_double_quote&quot;,text:&#39;&quot;&#39;,pos:n})},right_double_quote:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;right_double_quote&quot;,text:&#39;&quot;&#39;,pos:n})},ellipses:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;ellipses&quot;,text:&quot;...&quot;,pos:n})},en_dash:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;en_dash&quot;,text:&quot;--&quot;,pos:n})},em_dash:(t,e,s,n)=&gt;{P({tag:&quot;smart_punctuation&quot;,type:&quot;em_dash&quot;,text:&quot;---&quot;,pos:n})},blankline:(t,e,s,n)=&gt;{let i;&quot;tight&quot;in C().data?i=C():w.length&gt;=2&amp;&amp;&quot;tight&quot;in w[w.length-2].data&amp;&amp;(i=w[w.length-2]),i&amp;&amp;(i.data.blanklines=!0)}},M=function(t,s){let n,i,a;e.sourcePositions&amp;&amp;(n=r(s.startpos),i=r(s.endpos),a={start:n,end:i});let o=s.annot,c=[];if(s.annot.includes(&quot;|&quot;)){const t=s.annot.split(&quot;|&quot;);o=t[0],c=t.slice(1)}if(g&gt;0&amp;&amp;&quot;blankline&quot;!==o){let e;const s=C();s&amp;&amp;(s.data&amp;&amp;&quot;tight&quot;in s.data?e=s:t.length&gt;=2&amp;&amp;&quot;tight&quot;in t[t.length-2].data&amp;&amp;(e=t[t.length-2])),e&amp;&amp;(!/^[+-]list/.test(o)&amp;&amp;e.data.blanklines&amp;&amp;(e.data.tight=!1),/^[-+]list_item$/.test(o)||(e.data.blanklines=!1))}const l=I[o];l&amp;&amp;l(c,s.startpos,s.endpos,a)},w=[{children:[],data:{headinglevel:0},pos:{start:{line:0,col:0,offset:0},end:{line:0,col:0,offset:0}}}];let v,S=0;for(const t of m)M(w,t),S=t.endpos;e.sourcePositions&amp;&amp;(v=r(S));let y=C();for(;y&amp;&amp;y.data.headinglevel&gt;0;)x(v&amp;&amp;{start:v,end:v}),P({tag:&quot;section&quot;,children:y.children,attributes:y.attributes,pos:y.pos}),y=C();const T={tag:&quot;doc&quot;,references:u,footnotes:p,children:w[0].children};return w[0].attributes&amp;&amp;(T.attributes=w[0].attributes),T};const d={children:!0,tag:!0,pos:!0,attributes:!0,references:!0,footnotes:!0},u=function(t){return JSON.stringify(t).replace(/\\\n/g,&quot;\\n&quot;)},p=function(t,e,s){if(e.push(&quot; &quot;.repeat(s)),s&gt;128)e.push(&quot;(((DEEPLY NESTED CONTENT OMITTED)))\n&quot;);else{e.push(t.tag),t.pos&amp;&amp;e.push(` (${t.pos.start.line}:${t.pos.start.col}:${t.pos.start.offset}-${t.pos.end.line}:${t.pos.end.col}:${t.pos.end.offset})`);for(const s in t)if(!d[s]){const n=t[s];null!=n&amp;&amp;e.push(` ${s}=${u(n)}`)}if(t.attributes)for(const s in t.attributes)e.push(` ${s}=${u(t.attributes[s])}`);if(e.push(&quot;\n&quot;),t.children)for(const n of t.children)p(n,e,s+2)}};e.renderAST=function(t){const e=[];if(p(t,e,0),Object.keys(t.references).length&gt;0){e.push(&quot;references\n&quot;);for(const s in t.references)e.push(`  [${u(s)}] =\n`),p(t.references[s],e,4)}if(Object.keys(t.footnotes).length&gt;0){e.push(&quot;footnotes\n&quot;);for(const s in t.footnotes)e.push(`  [${u(s)}] =\n`),p(t.footnotes[s],e,4)}return e.join(&quot;&quot;)}},412:(t,e)=&gt;{Object.defineProperty(e,&quot;__esModule&quot;,{value:!0}),e.version=void 0,e.version=&quot;0.2.3&quot;}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,s),r.exports}var n={};return(()=&gt;{var t=n;Object.defineProperty(t,&quot;__esModule&quot;,{value:!0}),t.version=t.renderDjot=t.toPandoc=t.fromPandoc=t.applyFilter=t.HTMLRenderer=t.renderHTML=t.parseEvents=t.renderAST=t.parse=void 0;var e=s(306);Object.defineProperty(t,&quot;parse&quot;,{enumerable:!0,get:function(){return e.parse}}),Object.defineProperty(t,&quot;renderAST&quot;,{enumerable:!0,get:function(){return e.renderAST}});var i=s(155);Object.defineProperty(t,&quot;parseEvents&quot;,{enumerable:!0,get:function(){return i.parseEvents}});var r=s(240);Object.defineProperty(t,&quot;renderHTML&quot;,{enumerable:!0,get:function(){return r.renderHTML}}),Object.defineProperty(t,&quot;HTMLRenderer&quot;,{enumerable:!0,get:function(){return r.HTMLRenderer}});var a=s(322);Object.defineProperty(t,&quot;applyFilter&quot;,{enumerable:!0,get:function(){return a.applyFilter}});var o=s(56);Object.defineProperty(t,&quot;fromPandoc&quot;,{enumerable:!0,get:function(){return o.fromPandoc}}),Object.defineProperty(t,&quot;toPandoc&quot;,{enumerable:!0,get:function(){return o.toPandoc}});var c=s(423);Object.defineProperty(t,&quot;renderDjot&quot;,{enumerable:!0,get:function(){return c.renderDjot}});var l=s(412);Object.defineProperty(t,&quot;version&quot;,{enumerable:!0,get:function(){return l.version}})})(),n})()));
\ No newline at end of file
diff --git a/djot/js/main.js b/djot/js/main.js
new file mode 100644
index 0000000..2d84655
--- /dev/null
+++ b/djot/js/main.js
@@ -0,0 +1,37 @@
+// Assumes this script is prepended with the djot.js dist file.
+// See Makefile for details.
+const djot = module.exports;
+let buffer = new Uint8Array();
+const MSG_DELIMITER = 255; // 0xFF which doesn&#39;t appear in valid UTF-8
+const END = new Uint8Array([MSG_DELIMITER]);
+
+process.stdin.on(&quot;data&quot;, (chunk) =&gt; {
+  buffer = concatTypedArray(buffer, chunk);
+
+  // Loop here to handle case where multiple messages come in 1 chunk
+  while (true) {
+    const endIndex = buffer.indexOf(MSG_DELIMITER);
+
+    if (endIndex === -1) {
+      return;
+    }
+
+    const msg = buffer.subarray(0, endIndex);
+    buffer = buffer.subarray(endIndex + 1);
+    handleMessage(msg);
+  }
+});
+
+function concatTypedArray(former, latter) {
+  const result = new Uint8Array(former.length + latter.length);
+  result.set(former);
+  result.set(latter, former.length);
+  return result;
+}
+
+function handleMessage(msg) {
+  const input = new TextDecoder().decode(msg);
+  const output = djot.renderHTML(djot.parse(input));
+  const outputBytes = new TextEncoder().encode(output);
+  process.stdout.write(concatTypedArray(outputBytes, END));
+}
diff --git a/main.go b/main.go
index ebc5a52..4f86a92 100644
--- a/main.go
+++ b/main.go
@@ -5,11 +5,11 @@
 	&quot;fmt&quot;
 	&quot;io/fs&quot;
 	&quot;net/http&quot;
-	&quot;os&quot;
 	&quot;path/filepath&quot;
 	&quot;strings&quot;
 
 	&quot;github.com/BurntSushi/toml&quot;
+	&quot;go.imnhan.com/webmaker2000/djot&quot;
 )
 
 func main() {
@@ -22,7 +22,7 @@ func main() {
 	if err != nil {
 		panic(err)
 	}
-	fsys := os.DirFS(absolutePath)
+	fsys := WriteDirFS(absolutePath)
 
 	meta := readSiteMetadata(fsys)
 	fmt.Println(&quot;Found site:&quot;, meta)
@@ -31,6 +31,7 @@ func main() {
 	fmt.Printf(&quot;Found %d articles:\n&quot;, len(articles))
 	for _, a := range articles {
 		fmt.Println(&quot;&gt;&quot;, a.Path, &quot;-&quot;, a.Meta.Title)
+		a.WriteHtmlFile()
 	}
 
 	println(&quot;Serving local website at http://localhost:&quot; + port)
@@ -46,7 +47,7 @@ type SiteMetadata struct {
 	Tagline string
 }
 
-func readSiteMetadata(fsys fs.FS) (sm SiteMetadata) {
+func readSiteMetadata(fsys WritableFS) (sm SiteMetadata) {
 	_, err := toml.DecodeFS(fsys, &quot;website.toml&quot;, &amp;sm)
 	if err != nil {
 		panic(err)
@@ -54,21 +55,33 @@ func readSiteMetadata(fsys fs.FS) (sm SiteMetadata) {
 	return sm
 }
 
+const DJOT_EXT = &quot;.dj&quot;
+
 type Article struct {
+	Fs       WritableFS
 	Path     string
 	DjotBody string
 	Meta     ArticleMetadata
 }
 
+func (a *Article) WriteHtmlFile() {
+	html := djot.ToHtml(a.DjotBody)
+	path := strings.TrimSuffix(a.Path, DJOT_EXT) + &quot;.html&quot;
+	err := a.Fs.WriteFile(path, html)
+	if err != nil {
+		panic(err)
+	}
+}
+
 type ArticleMetadata struct {
 	Title  string
 	IsPage bool
 }
 
-func findArticles(fsys fs.FS) (articles []Article) {
+func findArticles(fsys WritableFS) (articles []Article) {
 
 	fs.WalkDir(fsys, &quot;.&quot;, func(path string, d fs.DirEntry, err error) error {
-		if d.IsDir() || !strings.HasSuffix(d.Name(), &quot;.dj&quot;) {
+		if d.IsDir() || !strings.HasSuffix(d.Name(), DJOT_EXT) {
 			return nil
 		}
 
@@ -93,6 +106,7 @@ func findArticles(fsys fs.FS) (articles []Article) {
 		}
 
 		article := Article{
+			Fs:       fsys,
 			Path:     path,
 			DjotBody: bodyText,
 			Meta:     meta,
diff --git a/writablefs.go b/writablefs.go
new file mode 100644
index 0000000..05a3fde
--- /dev/null
+++ b/writablefs.go
@@ -0,0 +1,28 @@
+package main
+
+import (
+	&quot;io/fs&quot;
+	&quot;os&quot;
+	&quot;path/filepath&quot;
+)
+
+type WritableFS interface {
+	fs.FS
+	WriteFile(path string, content string) error
+}
+
+// Like os.DirFS but is writable
+func WriteDirFS(path string) WritableFS {
+	return writeDirFS(path)
+}
+
+type writeDirFS string
+
+func (w writeDirFS) Open(name string) (fs.File, error) {
+	return os.DirFS(string(w)).Open(name)
+}
+
+func (w writeDirFS) WriteFile(path string, content string) error {
+	fullPath := filepath.Join(string(w), path)
+	return os.WriteFile(fullPath, []byte(content), 0644)
+}
diff --git a/www/about/index.html b/www/about/index.html
new file mode 100644
index 0000000..c84b188
--- /dev/null
+++ b/www/about/index.html
@@ -0,0 +1,9 @@
+&lt;section id=&quot;About-this-site&quot;&gt;
+&lt;h2&gt;About this site&lt;/h2&gt;
+&lt;p&gt;It’s a website.&lt;/p&gt;
+&lt;/section&gt;
+&lt;section id=&quot;No-really&quot;&gt;
+&lt;h2&gt;No really&lt;/h2&gt;
+&lt;p&gt;It really &lt;em&gt;is&lt;/em&gt; a full-blown
+&lt;a href=&quot;https://motherfuckingwebsite.com/&quot;&gt;mf-ing website&lt;/a&gt;.&lt;/p&gt;
+&lt;/section&gt;
diff --git a/www/hello/index.html b/www/hello/index.html
new file mode 100644
index 0000000..3217db9
--- /dev/null
+++ b/www/hello/index.html
@@ -0,0 +1 @@
+&lt;p&gt;Hello world.&lt;/p&gt;
</pre></body></html>