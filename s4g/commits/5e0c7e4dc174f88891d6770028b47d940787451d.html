<!DOCTYPE html>
<html lang="en" style="font-family: monospace;"><head><title>[5e0c7e4dc1] init state.clients right next to declaration | s4g | Boast</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body><strong><a href="../../">Repos</a> / <a href="../">s4g</a> / 5e0c7e4dc1</strong><hr><pre>commit 5e0c7e4dc174f88891d6770028b47d940787451d
Author: Nh√¢n &lt;hi@imnhan.com&gt;
Date:   Sun Jul 9 13:09:34 2023 +0700

    init state.clients right next to declaration

diff --git a/livereload/livereload.go b/livereload/livereload.go
index e7de673..dfd7926 100644
--- a/livereload/livereload.go
+++ b/livereload/livereload.go
@@ -20,18 +20,18 @@
 var pleaseReload = []byte(&quot;1&quot;)
 var dontReload = []byte(&quot;0&quot;)
 
-var state struct {
+var state = struct {
 	// Maps each client ID to whether they should reload on next ajax request.
 	//
 	// Client IDs are generated on client side so that an open tab&#39;s
 	// livereload feature keeps working even when the server is restarted.
 	clients map[string]bool
 	mut     sync.RWMutex
+}{
+	clients: make(map[string]bool),
 }
 
 func init() {
-	state.clients = make(map[string]bool)
-
 	lrScript = bytes.ReplaceAll(
 		lrScript, []byte(&quot;{{LR_ENDPOINT}}&quot;), []byte(endpoint),
 	)
</pre></body></html>